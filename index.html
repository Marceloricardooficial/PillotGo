<!doctype html>
<html lang="pt-BR">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Relatório Diário – Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
<style>
:root{--bg:#fff;--card:#fff;--muted:#6b7280;--dark-gray:#7d8492;--primary:#166534;--secondary:#22c55e;--blue-light:#60a5fa;--action-blue:#3b82f6;--action-blue-hover:#2563eb;--action-save:#22c55e;--green-lime:#4ade80;--shadow:0 6px 18px rgba(16,24,40,0.08);--action-bg:#e2e8f0;--action-text:#334155;--action-dark:#000;--action-icon-light:var(--secondary);--action-red:#ef4444;--action-red-hover:#dc2626}*{box-sizing:border-box}body{background:var(--bg);margin:0;padding:0;font-family:Roboto,sans-serif;color:#0f172a}.container{max-width:1080px;margin:0 auto;padding:0}header{width:100%;position:relative;overflow:visible}header img{width:100%;height:auto;display:block;object-fit:cover}#headerActionsBar{position:absolute;top:25px;left:0;width:100%;max-width:1080px;margin:0 auto;padding:0 20px;display:flex;justify-content:flex-start;align-items:flex-start;z-index:10;box-sizing:border-box}main.grid{padding:0 20px 20px;margin-top:20px;display:grid;gap:16px}@media (min-width:761px){#headerActionsBar{top:30px;left:50%;transform:translateX(-50%);padding:0}#headerActionsBar>#dropUpContainer{margin-left:20px}}#dropUpContainer{position:relative;z-index:20;width:40px;height:40px}#dropUpButton{width:40px;height:40px;border-radius:50%;background:var(--action-dark);color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;box-shadow:0 4px 10px rgba(0,0,0,0.3);cursor:pointer;transition:transform 0.2s,opacity 0.2s;border:none}#dropUpButton:hover{transform:scale(1.1);opacity:0.95}#dropUpMenu{position:absolute;top:100%;left:0;margin-top:10px;background:#fff;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.15);padding:8px 0;min-width:200px;opacity:0;visibility:hidden;transform:translateY(-10px);transition:opacity 0.3s ease,transform 0.3s ease,visibility 0.3s;border:1px solid #e2e8f0}#dropUpMenu.open{opacity:1;visibility:visible;transform:translateY(0)}.drop-up-item{display:flex;align-items:center;gap:10px;padding:10px 15px;color:var(--action-dark);font-weight:500;cursor:pointer;transition:background-color 0.2s;font-size:15px}.drop-up-item:hover{background:#f0f9f0}.drop-up-item i{color:var(--primary);font-size:16px}.drop-up-item.divider-top{border-top:1px solid #e2e8f0;margin-top:5px;padding-top:12px}#btnInserirJornada{background:var(--secondary);color:#fff;font-weight:700;padding:14px 25px;border-radius:9999px;border:none;cursor:pointer;font-size:16px;display:flex;align-items:center;justify-content:center;gap:10px;width:80%;max-width:250px;margin:20px auto 0;box-shadow:0 4px 10px rgba(0,0,0,0.2);transition:background-color 0.2s,transform 0.2s}#btnInserirJornada:hover{background:var(--primary);transform:translateY(-2px)}@media (max-width:760px){#headerActionsBar{top:15px;padding:0 10px}#dropUpContainer{width:40px;height:40px;font-size:24px}#dropUpMenu{top:100%;left:0;min-width:180px}}#mainSummaryCard{padding:0;display:flex;flex-direction:column;align-items:center;gap:15px}#lucroDisplay{width:100%;text-align:center;position:relative;display=flex;align-items:center;justify-content:center;padding:0;margin-bottom:10px}.lucro-rect{background:var(--action-dark);border:none;border-radius:9999px;padding:12px 25px;max-width:300px;box-shadow:none;display:inline-block;width:auto}#lucroDisplay .label{color:#fff;font-size:14px;font-weight:500;margin-bottom:0}#lucroDisplay .value{font-family:'Poppins',sans-serif;font-size:32px;font-weight:700;color:#fff;line-height:1.1}#lucroLiquidoTotal .currency{color:var(--secondary)}#toggleLucroBtn{position:absolute;left:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--secondary);font-size:20px;cursor:pointer;padding:5px;z-index:20;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color 0.2s}#toggleLucroBtn:hover{background:rgba(34,197,94,0.2)}#toggleLucroBrutoBtn{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:transparent;border:none;color:var(--secondary);font-size:18px;cursor:pointer;padding:5px;z-index:20;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:background-color 0.2s}#toggleLucroBrutoBtn:hover{background:rgba(34,197,94,0.2)}.summary-stats{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:10px;width:100%;padding:15px 0 0;border:none;border-top:1px solid #e2e8f0}.stat-simple{display:flex;flex-direction:column;align-items:center;text-align:center;padding:0 5px}.stat-simple i{color:var(--action-text);margin-bottom:8px;font-size:20px}.stat-simple .value{font-weight:700;font-size:16px;color:var(--action-text);line-height:1.2;margin-bottom:5px;display:flex;align-items:baseline;justify-content:center;gap:1px}.stat-label{font-size:11px;color:var(--secondary);font-weight:500;margin-top:2px}.value-number{font-size:16px}.value-unit,.value-currency{font-size:10px;opacity:0.8}@media (max-width:760px){.summary-stats{grid-template-columns:1fr 1fr 1fr 1fr;gap:5px;padding-top:10px}.stat-simple{padding:0 3px}.stat-simple i{font-size:16px;margin-bottom:5px}.stat-simple .value{font-size:14px}.stat-label{font-size:10px}.lucro-rect{padding:10px 20px;max-width:250px}#toggleLucroBtn,#toggleLucroBrutoBtn{width:32px;height:32px;font-size:16px}#toggleLucroBtn{left:5px}#toggleLucroBrutoBtn{right:5px}#btnInserirJornada{margin-top:15px}}.grid{display:grid;gap:16px}.card{background:var(--card);border-radius:12px;box-shadow:var(--shadow);padding:16px;position:relative;z-index:5}#weeklyProfitChartCard h3,#jornadasSalvasCard h3{font-family:'Poppins',sans-serif;font-weight:700;color:var(--action-dark);margin-top:0;margin-bottom:15px;font-size:24px;display:flex;align-items:center;gap:10px}.icon-circle-profit{width:30px;height:30px;border-radius:50%;background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:15px}.weekly-nav-bar,.daily-date-navigator{display:flex;justify-content:space-between;align-items:center;background:transparent;padding:10px 15px;border-radius:8px;margin-bottom:10px}.daily-date-navigator{max-width:300px;margin:0 auto 15px;padding:8px 10px}.weekly-nav-bar button{background:var(--action-dark);color:#fff;border:none;border-radius:50%;width:30px;height:30px;font-size:14px;cursor:pointer;transition:opacity 0.2s,transform 0.2s;display:flex;align-items:center;justify-content:center}.weekly-nav-bar button:hover{opacity:0.9;transform:scale(1.1)}.weekly-nav-bar button:disabled{background:#cbd5e1;cursor:not-allowed;opacity:0.6;transform:none}.daily-date-navigator button{background:transparent;color:var(--action-dark);border:none;font-size:18px;cursor:pointer;transition:all 0.2s ease;display:flex;align-items:center;justify-content:center;width:32px;height:32px;border-radius:50%}.daily-date-navigator button:hover{background:rgba(0,0,0,0.08);transform:scale(1.1)}.daily-date-navigator button:disabled{color:#cbd5e1;cursor:not-allowed;opacity:0.6;transform:none;background:transparent}.weekly-summary,.date-display{text-align:center;font-family:'Poppins',sans-serif}.date-display{font-family:'Roboto',sans-serif;font-size:14px;color:var(--action-dark);font-weight:400;padding:0 10px;flex-grow:1;text-align:center;text-transform:uppercase;letter-spacing:0.5px}.weekly-summary .label{font-size:12px;color:var(--dark-gray);font-weight:500;line-height:1.1}.weekly-summary .value{font-size:24px;font-weight:700;color:var(--primary);line-height:1.2}#weeklyProfitChartContainer{width:100%;height:150px;margin:10px 0 0}.jornadas-grid{display:grid;grid-template-columns:1fr;gap:30px;margin-top:10px;position:relative}.jornada-card{background:transparent;border-radius:0;padding:0 0 0 50px;display:flex;flex-direction:column;box-shadow:none;border:none;position:relative}.jornada-card::before{content:'';position:absolute;left:20px;top:8px;width:12px;height:12px;border-radius:50%;background:var(--secondary);border:none;z-index:10;animation:piscar 1s infinite}.jornada-card::after{content:'';position:absolute;left:25px;top:20px;bottom:-30px;width:2px;border-left:2px dotted var(--secondary);z-index:5}.jornada-card:last-child::after{display:none}.jornada-card.rascunho::before{background:var(--secondary);animation:piscar 1s infinite}.jornada-card.rascunho::after{border-left:2px dotted var(--secondary)}.jornada-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:8px}.jornada-header-left{flex:1}.jornada-km{font-size:16px;font-weight:700;color:var(--action-dark);margin-bottom:4px}.jornada-km-horario{display:flex;align-items:center;gap:8px}.jornada-horario{font-size:14px;color:var(--secondary);font-weight:400}.jornada-header-right{display:flex;gap:8px}.jornada-card .divider-line{height:1px;background-color:#e2e8f0;margin:8px 0 12px;width:100%}.jornada-card .jornada-info-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;margin-bottom:12px}.jornada-card .jornada-info-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:8px 5px;background:#f8fafc;border-radius:6px;box-shadow:0 1px 3px rgba(0,0,0,0.05);position:relative}.jornada-card .jornada-info-label{font-size:13px;color:var(--muted);margin-bottom:4px;display:flex;align-items:center;gap:2px}.jornada-card .jornada-info-value{font-size:15px;font-weight:700;color:var(--action-dark);display:flex;align-items:center;gap:2px}.jornada-card .jornada-info-value .currency-symbol{font-size:9px;color:var(--muted)}.jornada-card .star-icon{color:#fbbf24;font-size:10px;margin-left:2px}.jornada-card .efficiency-line-chart{display:flex;flex-direction:column;gap:8px;margin-bottom:12px;flex:1}.jornada-card .efficiency-label{font-size:10px;color:var(--muted);display:flex;justify-content:space-between}.jornada-card .efficiency-line-container{height:6px;background-color:#e2e8f0;border-radius:3px;overflow:hidden;position:relative}.jornada-card .efficiency-line-fill{height:100%;border-radius:3px;transition:width 0.5s ease}.jornada-footer{display:flex;gap:8px;margin-top:auto;align-items:center}.jornada-card .btn-edit,.jornada-card .btn-delete{border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;transition:opacity 0.2s,transform 0.2s}.jornada-card .btn-edit{background:var(--secondary);color:#fff}.jornada-card .btn-delete{background:var(--action-dark);color:#fff}.jornada-card .btn-edit:hover,.jornada-card .btn-delete:hover{opacity:0.9;transform:scale(1.1)}@media (max-width:760px){.jornadas-grid{gap:25px}.jornada-card{padding:0 0 0 40px}.jornada-card::before{left:16px;top:6px}.jornada-card::after{left:21px;top:18px;bottom:-25px}.jornada-km{font-size:14px}.jornada-horario{font-size:12px}.jornada-card .jornada-info-grid{grid-template-columns:1fr 1fr 1fr 1fr;gap:6px}.jornada-card .jornada-info-item{padding:6px 3px}.jornada-card .jornada-info-label{font-size:11px}.jornada-card .jornada-info-value{font-size:13px}.jornada-footer{flex-direction:column;align-items:stretch}.jornada-card .action-btn-wrap{justify-content:center}}.input-card-group{background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:15px;margin-bottom:20px}.input-card-group h5{font-family:'Poppins',sans-serif;font-weight:600;color:var(--action-text);margin:0 0 12px;font-size:15px;display:flex;align-items:center;gap:8px}.input-field-style,#dataJornada{width:100%;padding:10px 15px;border:none;border-radius:9999px;background:#e5e5e5;font-size:16px;box-sizing:border-box;color:#0f172a;font-weight:500;line-height:1.2}#dataJornada{text-align:center;margin-bottom:10px}.input-group-row{display:flex;gap:8px;margin-bottom:12px}.input-icon-wrap{position:relative;flex:1}#modalRegistroJornada .input-card-group .input-icon-wrap input,#modalRegistroJornada .input-card-group .input-ganho .input-icon-wrap input{padding-left:15px!important;text-align:left!important;border:none!important;background:#e5e5e5!important;border-radius:9999px!important}#modalRegistroJornada .input-card-group .input-icon-wrap .input-icon{display:none}#modalConfiguracao input{border-radius:9999px!important;background:#fff!important;padding:10px 15px 10px 35px!important;border:1px solid #e2e8f0!important;box-sizing:border-box;width:100%;font-size:16px;color:#0f172a;font-weight:500;line-height:1.2}#modalConfiguracao .input-icon-wrap .input-icon{display:block!important;position:absolute;left:10px;top:50%;transform:translateY(-50%);color:var(--action-dark);font-size:16px;z-index:5}.input-group-row label{display:none}#modalConfiguracao .input-group-row label{display:block!important;color:#fff;font-size:14px;margin-bottom:5px;font-weight:600}#modalConfiguracao .input-group-row label span{font-weight:400;font-size:12px;opacity:0.8;margin-left:5px}.ganho-input-row{display:flex;gap:10px;align-items:center;margin-bottom:10px;flex:1 1 48%}.ganho-input-row .icon-circle{flex-shrink:0;width:30px;height:30px;font-size:14px;font-weight:700}.ganho-input-row .input-icon-wrap{flex-grow:1}.icon-circle.icon-uber-form{background:#09091a;color:#fff}.icon-circle.icon-99-form{background:#ffc300;color:#000}.icon-circle.icon-indrive-form{background:#1e90ff;color:#fff}.icon-circle.icon-pf-form{background:#334155;color:#fff;font-size:14px}#modalActions{display:flex;justify-content:space-between;gap:10px;margin-top:15px;padding-top:10px;border-top:1px solid #e2e8f0}#modalActions button,#modalConfigActions button{padding:12px;border:none;border-radius:9999px;cursor:pointer;font-weight:700;font-size:15px;transition:opacity 0.2s,transform 0.2s}#modalActions button{flex:1;max-width:calc(50% - 5px)}#btnSalvarRascunho{background:var(--secondary);color:#fff}#btnPublicarJornada{background:var(--secondary);color:#fff}#modalConfigActions{display:flex;flex-direction:column;align-items:center;gap:10px;margin-top:25px;text-align:center}#modalConfigActions button{width:100%;max-width:250px;background:var(--secondary);color:#fff}#btnSalvarRascunho:hover,#btnPublicarJornada:hover,#modalConfigActions button:hover{opacity:0.9;transform:translateY(-1px)}#btnZerarApp{background:var(--action-dark)!important;color:var(--secondary)!important;border:2px solid var(--secondary)!important;font-size:14px!important;padding:10px 12px!important;margin-top:15px!important;max-width:200px!important}/* MODAL DE JORNADA MODIFICADO - SEM OVERLAY BRANCO */
#flashOverlay.modal-jornada{background-color:transparent;align-items:flex-end;justify-content:center}
#flashOverlay.modal-jornada .modal-content{width:100%;max-width:100%;border-radius:0;margin:0;padding:0;max-height:35vh;min-height:35vh;background:#fff;box-shadow:0 -5px 20px rgba(0,0,0,0.1);position:fixed;bottom:0;left:0;right:0;transform:translateY(0);transition:transform 0.3s ease}
#flashOverlay.modal-jornada.show .modal-content{transform:translateY(0)}
.modal-jornada-header{background:#f5f5f5;padding:15px;display:flex;justify-content:space-between;align-items:center;width:100%;border-bottom:2px solid #22c55e}
.modal-jornada-header-title{font-family:'Poppins',sans-serif;font-size:20px;font-weight:700;color:#000;text-align:center;flex:1}
.modal-jornada-header-close{background:transparent;border:none;color:#000;font-size:24px;cursor:pointer;width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:50%;transition:background 0.2s}
.modal-jornada-header-close:hover{background:rgba(0,0,0,0.1)}
.modal-jornada-content{padding:10px 15px 10px 15px;max-height:calc(35vh - 80px);overflow-y:auto}
/* Espaço reduzido entre título e campos no modal de jornada */
#modalRegistroJornada .modal-jornada-content .input-card-group:first-child {
    margin-top: 10px !important;
}

/* Espaço reduzido entre campos e botões no modal de jornada */
#modalRegistroJornada #modalActions {
    margin-top: 10px !important;
    padding-top: 10px !important;
    border-top: 1px solid #e2e8f0;
}

/* ESTILOS PARA MODAL EM MODO EDIÇÃO - ALTURA AUMENTADA */
#flashOverlay.modal-jornada.modal-edicao .modal-content {
    max-height: 70vh !important;
    min-height: 70vh !important;
}

#flashOverlay.modal-jornada.modal-edicao .modal-jornada-content {
    max-height: calc(70vh - 80px) !important;
}

/* ESPAÇO ADICIONAL ANTES DOS VALORES POR APP NO MODO EDIÇÃO */
#flashOverlay.modal-jornada.modal-edicao #camposGanhos {
    margin-top: 25px !important;
    padding-top: 15px !important;
    position: relative;
}

#flashOverlay.modal-jornada.modal-edicao #camposGanhos::before {
    content: '';
    position: absolute;
    top: 0;
    left: 15px;
    right: 15px;
    height: 1px;
    background-color: #e2e8f0;
}

#flashOverlay.modal-jornada.modal-edicao #camposGanhos h5 {
    margin-top: 5px !important;
}

@media (max-width:760px){
    #flashOverlay.modal-jornada.modal-edicao .modal-content {
        max-height: 85vh !important;
        min-height: 85vh !important;
    }
    
    #flashOverlay.modal-jornada.modal-edicao .modal-jornada-content {
        max-height: calc(85vh - 80px) !important;
        padding:10px 15px 10px 15px !important;
    }
    
    #flashOverlay.modal-jornada.modal-edicao #camposGanhos {
        margin-top: 20px !important;
    }
}
#flashOverlay{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,0.5);display:none;flex-direction:column;align-items:center;justify-content:center;text-align:center;z-index:10000;opacity:0;transition:opacity 0.3s ease}#flashOverlay.show{display:flex;opacity:1}#flashOverlay.modal-mode .modal-content,#flashOverlay.modal-config-gnv .modal-content,#flashOverlay.modal-confirmacao-zerar .modal-content,#flashOverlay.modal-menu-config .modal-content,#flashOverlay.modal-consciencia-zerar .modal-content,#flashOverlay.modal-metas .modal-content,#flashOverlay.modal-relatorio .modal-content,#flashOverlay.modal-despesas .modal-content,#flashOverlay.modal-pesquisa-despesas .modal-content,#flashOverlay.modal-config-despesas-veiculo .modal-content,#flashOverlay.modal-temas .modal-content{background:#fff;padding:30px;border-radius:12px;box-shadow:0 10px 25px rgba(0,0,0,0.3);max-width:90%;width:450px;max-height:90vh;transform:scale(0.8);transition:transform 0.3s ease;text-align:left}#flashOverlay.modal-menu-config .modal-content{max-width:300px;width:80%;padding:20px;text-align:center}#flashOverlay.flash-mode .modal-content{display:none}#flashOverlay.modal-mode.show .modal-content,#flashOverlay.modal-config-gnv.show .modal-content,#flashOverlay.modal-confirmacao-zerar.show .modal-content,#flashOverlay.modal-menu-config.show .modal-content,#flashOverlay.modal-consciencia-zerar.show .modal-content,#flashOverlay.modal-metas.show .modal-content,#flashOverlay.modal-relatorio.show .modal-content,#flashOverlay.modal-despesas.show .modal-content,#flashOverlay.modal-pesquisa-despesas.show .modal-content,#flashOverlay.modal-config-despesas-veiculo.show .modal-content,#flashOverlay.modal-temas.show .modal-content{transform:scale(1)}.menu-option-button{width:100%;padding:12px;margin-bottom:10px;border:2px solid var(--primary);border-radius:9999px;background:#fff;color:var(--primary);font-weight:700;font-size:16px;cursor:pointer;transition:background-color 0.2s,color 0.2s;display:flex;align-items:center;justify-content:center;gap:10px}.menu-option-button:hover{background:var(--primary);color:#fff}#modalConscienciaZerar h2{color:var(--action-dark);font-family:'Poppins',sans-serif;font-weight:700;margin-top:0;text-align:center}#modalConscienciaZerar .consciencia-text{font-size:15px;color:var(--action-text);margin-bottom:25px;text-align:center;padding:0 10px;border:1px dashed var(--action-red);padding:15px;border-radius:8px;background:#fee2e2}#modalConscienciaZerar .modal-actions{display:flex;justify-content:space-around;gap:10px;margin-top:20px}#modalConscienciaZerar .modal-actions button{padding:12px 20px;border:none;border-radius:9999px;cursor:pointer;font-weight:700;font-size:15px;flex:1;max-width:200px;transition:opacity 0.2s,transform 0.2s}#modalConscienciaZerar .btn-cancel{background:#e5e5e5;color:var(--action-text)}#modalConscienciaZerar .btn-confirm-apagar{background:var(--action-red);color:#fff;border:none}#modalConscienciaZerar .btn-confirm-apagar:hover{background:var(--action-red-hover);transform:translateY(-1px)}footer{text-align:center;padding:15px 0;font-size:14px;background:var(--bg);color:var(--action-dark);font-weight:500}footer strong{font-weight:700;color:var(--primary)}@media (max-width:760px){#flashOverlay.modal-jornada .modal-content{max-height:40vh;min-height:40vh}
.modal-jornada-content{max-height:calc(40vh - 80px);padding:10px 15px 10px 15px !important;}
#flashOverlay.modal-mode .modal-content,#flashOverlay.modal-config-gnv .modal-content,#flashOverlay.modal-confirmacao-zerar .modal-content,#flashOverlay.modal-menu-config .modal-content,#flashOverlay.modal-consciencia-zerar .modal-content,#flashOverlay.modal-metas .modal-content,#flashOverlay.modal-relatorio .modal-content,#flashOverlay.modal-despesas .modal-content,#flashOverlay.modal-pesquisa-despesas .modal-content,#flashOverlay.modal-config-despesas-veiculo .modal-content,#flashOverlay.modal-temas .modal-content{max-width:95%;width:100%;height:100%;max-height:100%;border-radius:0;padding:20px;overflow-y:auto}#modalActions{flex-direction:row;flex-wrap:wrap}#modalActions button{flex:1 1 calc(50% - 5px);margin-bottom:0}#modalConfigActions button{max-width:100%}#btnZerarApp{max-width:100%!important}#modalConfirmacaoZerar .modal-actions{flex-direction:column}}.floating-button-container{position:fixed;bottom:20px;right:20px;z-index:1000}.floating-button{width:60px;height:60px;border-radius:50%;background-color:var(--secondary);border:2px solid var(--action-dark);display:flex;align-items:center;justify-content:center;box-shadow:0 6px 18px rgba(0,0,0,0.3);cursor:pointer;transition:all 0.3s ease}.floating-button i{color:var(--action-dark);font-size:28px}.floating-button:hover{transform:scale(1.1);background-color:var(--primary)}@media (max-width:760px){.floating-button-container{right:10px;bottom:10px}.floating-button{width:50px;height:50px}.floating-button i{font-size:24px}}.metas-container{padding:20px 0;display:grid;grid-template-columns:1fr 1fr;gap:15px;width:100%}.meta-item{display:flex;flex-direction:column;padding:15px;border:1px solid #e2e8f0;border-radius:12px;background:#f8fafc;box-shadow:0 2px 8px rgba(0,0,0,0.05);width:100%}.dia-semana{font-weight:700;color:var(--action-dark);font-size:16px;margin-bottom:12px;text-align:center}.meta-input-group{display:flex;gap:10px;align-items:center;width:100%}.meta-valor{flex:1;width:100%}.meta-valor input{width:100%;padding:12px 15px;border:2px solid #e2e8f0;border-radius:12px;text-align:center;font-size:14px;background:#fff;font-weight:600;box-sizing:border-box}.meta-actions{display:flex;justify-content:center;margin-top:25px;gap:10px;grid-column:1/-1;width:100%}.meta-actions button{padding:12px 20px;border:none;border-radius:9999px;cursor:pointer;font-weight:700;font-size:14px;transition:all 0.2s ease}#btnSalvarTodasMetas{background:var(--secondary);color:#fff}#btnLimparMetas{background:var(--action-dark);color:#fff}#btnSalvarTodasMetas:hover,#btnLimparMetas:hover{opacity:0.9;transform:translateY(-2px)}.modal-header-meta{display:flex;justify-content:space-between;align-items:center;background:var(--action-dark);padding:20px 25px;margin:-30px -30px 25px;border-top-left-radius:12px;border-top-right-radius:12px;border-bottom:2px solid #e2e8f0;color:#fff}.modal-meta-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:20px;color:#fff;margin-left:10px}.modal-header-meta-right{display:flex;align-items:center;gap:15px}.close-meta-modal{width:40px;height:40px;border-radius:50%;background:transparent;border:none;color:var(--secondary);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease}.close-meta-modal:hover{transform:scale(1.1);background:rgba(255,255,255,0.2)}.switch{position:relative;display:inline-block;width:50px;height:24px}.switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:24px}.slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--secondary)}input:checked+.slider:before{transform:translateX(26px)}@media (max-width:760px){.metas-container{grid-template-columns:1fr 1fr;gap:10px}.meta-item{padding:12px 8px}.dia-semana{font-size:14px;margin-bottom:8px}.meta-valor input{font-size:13px;padding:10px 8px}.meta-actions{flex-direction:row;margin-top:20px}.meta-actions button{flex:1;font-size:13px;padding:10px 15px}.modal-header-meta{padding:15px 20px;margin:-20px -20px 20px}.modal-meta-title{font-size:18px}.close-meta-modal{width:35px;height:35px;font-size:16px}}@media (max-width:480px){.metas-container{grid-template-columns:1fr 1fr;gap:8px}.meta-item{padding:10px 6px}.dia-semana{font-size:13px}.meta-valor input{font-size:12px;padding:8px 6px}.meta-actions{flex-direction:row;gap:8px}.meta-actions button{font-size:12px;padding:8px 12px}.modal-header-meta{padding:12px 15px}.modal-meta-title{font-size:16px}}@media (max-width:360px){.metas-container{grid-template-columns:1fr 1fr;gap:6px}.meta-item{padding:8px 4px}.dia-semana{font-size:12px}.meta-valor input{font-size:11px;padding:6px 4px}}.modal-relatorio-header{background:var(--action-dark);padding:25px 40px;margin:-30px -30px 0;border-top-left-radius:12px;border-top-right-radius:12px;color:#fff;position:relative;display:flex;justify-content:space-between;align-items:center;min-height:80px}.relatorio-header-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:18px;color:#fff;margin:0;display:flex;align-items:center;height:100%}.relatorio-meta-container{background:var(--secondary);padding:20px 40px;margin:0 -30px;display:flex;justify-content:space-between;align-items:center;color:#fff;position:relative;min-height:120px}.relatorio-meta-info{flex:1;display:flex;flex-direction:column;justify-content:center;height:100%}.relatorio-data{font-size:14px;font-weight:500;margin-bottom:5px;color:#fff}.relatorio-meta-valor{font-size:24px;font-weight:700;color:#fff}.relatorio-meta-grafico{width:90px;height:90px;border-radius:50%;background:conic-gradient(var(--action-dark) 0% 98%,rgba(255,255,255,0.3) 98% 100%);display:flex;align-items:center;justify-content:center;margin:0;align-self:center}.relatorio-meta-grafico-circle{width:80px;height:80px;border-radius:50%;background:#fff;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:18px;color:var(--action-dark)}.relatorio-container{padding:20px 0;display:flex;flex-direction:column;gap:0;width:100%}.relatorio-grid-3-colunas,.relatorio-linha-cinza{margin-bottom:20px}.relatorio-grid-3-colunas{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;width:100%}.relatorio-item-simples{display:flex;flex-direction:column;align-items:center;text-align:center;padding:10px}.relatorio-item-label{font-size:16px;color:var(--action-dark);margin-bottom:8px;display:flex;align-items:center;gap:4px;font-weight:600}.relatorio-item-value{font-size:22px;font-weight:700;color:var(--action-dark);display:flex;align-items:baseline;gap:2px}.relatorio-item-value .currency-symbol{font-size:12px;opacity:0.8}.relatorio-item-value.positive{color:var(--secondary)}.relatorio-item-value.negative{color:var(--action-red)}.relatorio-item-value.neutral{color:var(--muted)}.relatorio-divider-green{height:2px;background:var(--secondary);width:100%;margin:15px 0;border-radius:1px}.relatorio-despesas-section{background:#f8fafc;border-radius:0;padding:20px;margin:0 -30px 0;border:none;box-shadow:none;width:calc(100% + 60px);margin-top:0;margin-bottom:0}.relatorio-despesas-title{font-family:'Poppins',sans-serif;font-weight:700;font-size:18px;color:var(--action-dark);margin-bottom:15px;text-align:center}.relatorio-despesas-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:15px;width:100%}.relatorio-despesa-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:10px}.relatorio-despesa-label{font-size:14px;color:var(--action-dark);margin-bottom:8px;display:flex;align-items:center;gap:4px;font-weight:600}.relatorio-despesa-value{font-size:18px;font-weight:700;color:var(--action-dark);display:flex;align-items:baseline;gap:2px}.relatorio-despesa-value.negative{color:var(--action-red)}.relatorio-meta-progress{height:8px;background-color:#e2e8f0;border-radius:4px;overflow:hidden;margin-top:5px}.relatorio-meta-progress-fill{height:100%;background-color:var(--secondary);border-radius:4px;transition:width 0.5s ease}.relatorio-meta-stats{display:flex;justify-content:space-between;font-size:12px;color:var(--muted)}.relatorio-section-title{font-family:'Poppins',sans-serif;font-weight:600;font-size:18px;color:var(--action-dark);margin-bottom:10px;display:flex;align-items:center;gap:8px}.relatorio-falta-meta{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px}.relatorio-falta-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:10px;background:#f1f5f9;border-radius:8px}.relatorio-falta-label{font-size:14px;color:var(--muted);margin-bottom:5px}.relatorio-falta-value{font-size:20px;font-weight:700;color:var(--action-dark)}@media (max-width:760px){.modal-relatorio-header{padding:20px 25px;min-height:70px}.relatorio-meta-container{padding:15px 25px;min-height:100px}.relatorio-grid-3-colunas{grid-template-columns:repeat(3,1fr);gap:10px}.relatorio-item-simples{padding:8px 5px}.relatorio-item-label{font-size:14px}.relatorio-item-value{font-size:18px}.relatorio-item-value .currency-symbol{font-size:10px}.relatorio-despesas-section{margin:0 -20px 0;width:calc(100% + 40px)}.relatorio-despesas-grid{grid-template-columns:repeat(2,1fr);gap:10px}.relatorio-despesa-label{font-size:12px}.relatorio-despesa-value{font-size:16px}.relatorio-falta-meta{grid-template-columns:repeat(3,1fr);gap:8px}.relatorio-falta-label{font-size:12px}.relatorio-falta-value{font-size:16px}.modal-relatorio-header,.relatorio-meta-container{margin:-20px -20px 0}.relatorio-header-title{font-size:16px}.relatorio-meta-valor{font-size:20px}.relatorio-meta-grafico{width:70px;height:70px}.relatorio-meta-grafico-circle{width:60px;height:60px;font-size:14px}}@media (max-width:480px){.relatorio-grid-3-colunas{grid-template-columns:repeat(3,1fr);gap:8px}.relatorio-item-simples{padding:6px 3px}.relatorio-item-label{font-size:12px}.relatorio-item-value{font-size:16px}.relatorio-item-value .currency-symbol{font-size:9px}.relatorio-despesas-grid{grid-template-columns:repeat(2,1fr);gap:8px}.relatorio-falta-meta{grid-template-columns:repeat(3,1fr);gap:6px}.relatorio-falta-label{font-size:11px}.relatorio-falta-value{font-size:14px}}.relatorio-apps-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px}.relatorio-app-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:10px}.relatorio-app-icon{width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:14px;font-weight:700}.relatorio-app-icon.uber{background:#09091a;color:#fff}.relatorio-app-icon.n99{background:#ffc300;color:#000}.relatorio-app-icon.indrive{background:#1e90ff;color:#fff}.relatorio-app-icon.pf{background:#334155;color:#fff}.relatorio-app-value{font-size:16px;font-weight:700;color:var(--action-dark);display:flex;align-items:baseline;gap:2px}.relatorio-app-value .currency-symbol{font-size:10px;opacity:0.8}@media (max-width:760px){.relatorio-apps-grid{grid-template-columns:1fr 1fr 1fr 1fr}.relatorio-app-value{font-size:14px}}.relatorio-linha-cinza{background-color:#f8fafc;margin:0 -30px;padding:15px 30px 10px;width:calc(100% + 60px)}.relatorio-divider-green-full{height:2px;background:var(--secondary);margin:0 -30px;width:calc(100% + 60px)}.relatorio-section-cinza{background-color:#f8fafc;margin:0 -30px;padding:20px 30px;width:calc(100% + 60px);margin-top:0}.relatorio-section-cinza .relatorio-section{background:#fff;padding:20px;margin:0 -20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05)}.despesas-container{padding:20px 0;display:flex;flex-direction:column;gap:15px;width:100%}.despesas-tipo-principal{display:grid;grid-template-columns:1fr 1fr;gap:15px;margin-bottom:20px}.despesas-tipo-coluna{display:flex;flex-direction:column;align-items:center;padding:20px 10px;background:#f8fafc;border-radius:12px;cursor:pointer;transition:all 0.2s ease;border:2px solid transparent}.despesas-tipo-coluna:hover{background:#e2e8f0}.despesas-tipo-coluna.selecionado{background:#e2e8f0;border-color:var(--secondary)}.despesas-tipo-icone{width:60px;height:60px;border-radius:50%;background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:24px;margin-bottom:10px}.despesas-tipo-label{font-size:16px;font-weight:600;color:var(--action-dark)}.despesas-form-section{display:none;animation:fadeIn 0.3s ease}.despesas-form-section.ativo{display:block}.despesas-form-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;flex-wrap:wrap;gap:10px}.despesas-form-title{font-family:'Poppins',sans-serif;font-weight:600;font-size:18px;color:var(--action-dark);margin:0}.despesas-botoes-acao{display:flex;gap:10px;align-items:center}.btn-inserir-despesa{background:var(--secondary);color:#fff;border:none;border-radius:9999px;padding:12px 20px;font-weight:600;font-size:14px;cursor:pointer;display:flex;align-items:center;gap:8px;transition:all 0.2s ease;white-space:nowrap}.btn-inserir-despesa:hover{background:var(--primary);transform:translateY(-2px)}.btn-lupa,.btn-config{width:44px;height:44px;border-radius:50%;background:var(--action-dark);color:#fff;border:none;display:flex;align-items:center;justify-content:center;font-size:16px;cursor:pointer;transition:all 0.2s ease}.btn-lupa:hover,.btn-config:hover{background:#333;transform:scale(1.1)}.despesas-formulario{background:#f8fafc;border-radius:12px;padding:20px;margin-top:20px;animation:slideDown 0.3s ease;display:none}.despesas-formulario.ativo{display:block}.despesas-form-row{display:flex;flex-direction:column;gap:10px;margin-bottom:15px}.despesas-form-input,.despesas-form-select{width:100%;padding:12px 15px;border:2px solid #e2e8f0;border-radius:9999px;background:#fff;font-size:14px;font-weight:500;color:var(--action-dark);box-sizing:border-box}.despesas-form-select{appearance:none;background-image:url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");background-repeat:no-repeat;background-position:right 15px center;background-size:16px}.despesas-form-actions{display:flex;gap:10px;margin-top:20px}.despesas-form-btn{flex:1;padding:12px 20px;border:none;border-radius:9999px;font-weight:700;font-size:14px;cursor:pointer;transition:all 0.2s ease}.despesas-form-btn.save{background:var(--secondary);color:#fff}.despesas-form-btn.cancel{background:var(--action-dark);color:#fff}.despesas-form-btn:hover{opacity:0.9;transform:translateY(-2px)}.despesas-lista{display:flex;flex-direction:column;gap:10px;max-height:300px;overflow-y:auto;padding:10px 0;margin-top:20px}.despesa-item{display:flex;align-items:center;gap:15px;padding:12px 15px;background:#fff;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.05);border:1px solid #e2e8f0}.despesa-icon{width:40px;height:40px;border-radius:50%;background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0}.despesa-info{flex:1;display:flex;flex-direction:column;gap:4px}.despesa-tipo{font-size:14px;font-weight:600;color:var(--action-dark)}.despesa-descricao{font-size:12px;color:var(--muted)}.despesa-detalhes{font-size:11px;color:var(--muted);font-style:italic}.despesa-valor{font-size:16px;font-weight:700;color:var(--action-red)}.despesa-actions{display:flex;gap:8px}.despesa-btn{width:32px;height:32px;border-radius:50%;border:none;display:flex;align-items:center;justify-content:center;font-size:12px;cursor:pointer;transition:all 0.2s ease}.despesa-btn.edit{background:var(--secondary);color:#fff}.despesa-btn.delete{background:var(--action-dark);color:#fff}.despesa-btn:hover{opacity:0.9;transform:scale(1.1)}.despesas-total{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-top:2px solid #e2e8f0;margin-top:15px}.despesas-total-label{font-size:16px;font-weight:600;color:var(--action-dark)}.despesas-total-value{font-size:18px;font-weight:700;color:var(--action-red)}.despesa-empty{text-align:center;padding:30px 20px;color:var(--muted)}.despesa-empty i{font-size:40px;margin-bottom:10px;color:#cbd5e1}.despesa-empty p{margin:0;font-size:14px}.campos-especificos{display:none}.campos-especificos.ativo{display:block}.combustivel-opcoes{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:15px;width:100%}.combustivel-opcao{padding:15px 10px;border:2px solid #e2e8f0;border-radius:12px;background:#fff;cursor:pointer;transition:all 0.2s ease;text-align:center;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100px}.combustivel-opcao:hover{border-color:var(--secondary)}.combustivel-opcao.selecionado{border-color:var(--secondary);background:#f0f9ff}.combustivel-icon{width:50px;height:50px;border-radius:50%;background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:20px;margin-bottom:10px}.combustivel-nome{font-size:14px;font-weight:600;color:var(--action-dark);margin-bottom:4px}.combustivel-unidade{font-size:12px;color:var(--muted);font-weight:500}.oleo-alerta{background:#fee2e2;border:1px solid #fca5a5;border-radius:8px;padding:10px;margin-top:10px;font-size:12px;color:#dc2626;display:none}.oleo-alerta.ativo{display:block}.manutencao-parcelas{background:#f0f9ff;border:1px solid #bae6fd;border-radius:8px;padding:10px;margin-top:10px;font-size:12px;color:#0369a1}.parcela-item{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px dashed #bae6fd}.parcela-item:last-child{border-bottom:none}@keyframes fadeIn{from{opacity:0}to{opacity:1}}@keyframes slideDown{from{opacity:0;transform:translateY(-10px)}to{opacity:1;transform:translateY(0)}}.flash-success-icon{width:80px;height:80px;border-radius:50%;background:var(--secondary);display:flex;align-items:center;justify-content:center;margin:0 auto 20px;position:relative;animation:pulse 1.5s ease-in-out}.flash-success-icon::before{content:'';position:absolute;width:100%;height:100%;border-radius:50%;background:rgba(34,197,94,0.2);animation:ripple 1.5s ease-out infinite}.flash-success-icon i{font-size:36px;color:#fff;position:relative;z-index:2}@keyframes pulse{0%{transform:scale(0.8);opacity:0.7}50%{transform:scale(1);opacity:1}100%{transform:scale(0.8);opacity:0.7}}@keyframes ripple{0%{transform:scale(0.8);opacity:1}100%{transform:scale(2);opacity:0}}.flash-overlay-content{text-align:center;color:var(--action-dark)}.flash-overlay-content h2{font-family:'Poppins',sans-serif;font-weight:700;font-size:24px;margin-bottom:10px}.flash-overlay-content p{font-size:16px;color:var(--muted);margin-bottom:20px}@media (max-width:760px){.flash-success-icon{width:60px;height:60px}.flash-success-icon i{font-size:28px}.flash-overlay-content h2{font-size:20px}.despesas-form-header{flex-direction:column;align-items:flex-start}.despesas-botoes-acao{width:100%;justify-content:space-between}.combustivel-opcoes{grid-template-columns:repeat(3,1fr);gap:8px}.combustivel-opcao{padding:12px 8px;min-height:90px}.combustivel-icon{width:40px;height:40px;font-size:16px}.combustivel-nome{font-size:12px}}.pesquisa-filtros{display:flex;flex-direction:column;gap:15px;margin-bottom:20px}.pesquisa-filtro-row{display:flex;flex-direction:column;gap:8px}.pesquisa-filtro-label{font-size:14px;font-weight:600;color:var(--action-dark)}.pesquisa-datas{display:flex;gap:10px;align-items:center}.pesquisa-datas input{flex:1;padding:10px 15px;border:2px solid #e2e8f0;border-radius:9999px;background:#fff;font-size:14px;font-weight:500;color:var(--action-dark);box-sizing:border-box}.categorias-container{display:flex;flex-wrap:wrap;gap:8px;margin-top:5px}.categoria-checkbox{display:flex;align-items:center;gap:5px;padding:6px 12px;background:#f8fafc;border:2px solid #e2e8f0;border-radius:20px;cursor:pointer;transition:all 0.2s ease}.categoria-checkbox:hover{background:#e2e8f0}.categoria-checkbox.selecionada{background:var(--secondary);color:#fff;border-color:var(--secondary)}.categoria-checkbox input{display:none}.pesquisa-ordem{display:flex;gap:10px}.ordem-option{flex:1;padding:10px 15px;background:#f8fafc;border:2px solid #e2e8f0;border-radius:9999px;text-align:center;cursor:pointer;transition:all 0.2s ease;font-size:14px;font-weight:500}.ordem-option:hover{background:#e2e8f0}.ordem-option.selecionada{background:var(--secondary);color:#fff;border-color:var(--secondary)}.pesquisa-resultados{max-height:300px;overflow-y:auto;margin-top:20px;border-top:2px solid #e2e8f0;padding-top:15px}.pesquisa-total{display:flex;justify-content:space-between;align-items:center;padding:15px 0;border-top:2px solid #e2e8f0;margin-top:15px;font-weight:700;font-size:16px;color:var(--action-dark)}.pesquisa-acoes{display:flex;gap:10px;margin-top:20px}.pesquisa-acoes button{flex:1;padding:12px 20px;border:none;border-radius:9999px;font-weight:700;font-size:14px;cursor:pointer;transition:all 0.2s ease}.pesquisa-acoes button.pesquisar{background:var(--secondary);color:#fff}.pesquisa-acoes button.limpar{background:var(--action-dark);color:#fff}.pesquisa-acoes button:hover{opacity:0.9;transform:translateY(-2px)}.config-categorias{display:flex;flex-direction:column;gap:15px;margin-bottom:20px}.config-categoria-item{display:flex;justify-content:space-between;align-items:center;padding:12px 15px;background:#f8fafc;border-radius:12px;border:1px solid #e2e8f0}.config-categoria-info{display:flex;align-items:center;gap:10px}.config-categoria-icone{width:30px;height:30px;border-radius:50%;background:var(--secondary);color:#fff;display:flex;align-items:center;justify-content:center;font-size:14px}.config-categoria-nome{font-size:14px;font-weight:600;color:var(--action-dark)}.config-categoria-desc{font-size:12px;color:var(--muted);margin-top:2px}.config-switch{position:relative;display:inline-block;width:44px;height:24px}.config-switch input{opacity:0;width:0;height:0}.config-slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#ccc;transition:.4s;border-radius:24px}.config-slider:before{position:absolute;content:"";height:16px;width:16px;left:4px;bottom:4px;background-color:#fff;transition:.4s;border-radius:50%}input:checked+.config-slider{background-color:var(--secondary)}input:checked+.config-slider:before{transform:translateX(20px)}.config-info{background:#f0f9ff;border:1px solid #bae6fd;border-radius:8px;padding:15px;margin-top:20px;font-size:13px;color:#0369a1}.config-info i{margin-right:8px}.combustivel-odometro{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}.combustivel-odometro .despesas-form-row{margin-bottom:0}.sort-toggle-btn{background:transparent;color:var(--action-dark);border:none;border-radius:50%;width:32px;height:32px;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s ease;font-size:14px;padding:0}.sort-toggle-btn:hover{background:rgba(0,0,0,0.05)}.sort-toggle-btn.active{color:var(--secondary)}.sort-toggle-btn i{font-size:14px;transition:color 0.2s ease}.jornadas-header-container{display:flex;justify-content:space-between;align-items:center;margin-bottom:15px}.temas-container{padding:20px 0;display:grid;grid-template-columns:1fr 1fr;gap:15px;width:100%}.tema-option{display:flex;flex-direction:column;align-items:center;padding:20px 10px;background:#f8fafc;border-radius:12px;cursor:pointer;transition:all 0.2s ease;border:2px solid transparent}.tema-option:hover{background:#e2e8f0}.tema-option.selecionado{background:#e2e8f0;border-color:var(--secondary)}.tema-paleta{display:flex;gap:5px;margin-bottom:10px}.tema-cor{width:25px;height:25px;border-radius:50%;border:1px solid #e2e8f0}.tema-nome{font-size:14px;font-weight:600;color:var(--action-dark)}.tema-padrao .cor-1{background:#000}.tema-padrao .cor-2{background:#166534}.tema-padrao .cor-3{background:#fff}.tema-padrao .cor-4{background:#e5e7eb}.tema-preto-amarelo .cor-1{background:#000}.tema-preto-amarelo .cor-2{background:#fbbf24}.tema-preto-amarelo .cor-3{background:#fff}.tema-preto-amarelo .cor-4{background:#374151}.tema-preto-vermelho .cor-1{background:#000}.tema-preto-vermelho .cor-2{background:#dc2626}.tema-preto-vermelho .cor-3{background:#fff}.tema-preto-vermelho .cor-4{background:#374151}.tema-preto-roxo-amarelo .cor-1{background:#000}.tema-preto-roxo-amarelo .cor-2{background:#8b5cf6}.tema-preto-roxo-amarelo .cor-3{background:#fbbf24}.tema-preto-roxo-amarelo .cor-4{background:#374151}.tema-terra-verde .cor-1{background:#000}.tema-terra-verde .cor-2{background:#D09128}.tema-terra-verde .cor-3{background:#C4552E}.tema-terra-verde .cor-4{background:#364222}.daily-detail-card{background:var(--card);border-radius:12px;box-shadow:var(--shadow);padding:15px;margin-top:15px;display:none;animation:fadeIn 0.3s ease;max-height:70vh;overflow-y:auto}.daily-detail-card.show{display:block}.daily-detail-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:15px;padding-bottom:10px;border-bottom:1px solid #e2e8f0;flex-wrap:wrap}.daily-detail-header-left{display:flex;flex-direction:column;flex:1}.daily-detail-title{font-family:'Roboto',sans-serif;font-weight:400;font-size:12px;color:var(--muted);margin:0 0 5px 0;display:flex;align-items:center;gap:5px}.daily-detail-date{font-family:'Roboto',sans-serif;font-weight:400;font-size:11px;color:var(--dark-gray);margin:0}.daily-detail-lucro-header{font-family:'Poppins',sans-serif;font-weight:700;font-size:24px;color:var(--secondary);margin:0;text-align:right;flex-shrink:0;margin-left:15px}.daily-detail-close{background:transparent;border:none;color:var(--secondary);font-size:18px;cursor:pointer;width:30px;height:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;transition:all 0.2s ease;flex-shrink:0;margin-left:10px}.daily-detail-close:hover{background:rgba(0,0,0,0.05);transform:scale(1.1)}.daily-detail-content{display:flex;flex-direction:column;gap:15px}.daily-detail-row{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;margin-bottom:10px}.daily-detail-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:10px 5px;background:#f8fafc;border-radius:8px}.daily-detail-label{font-size:10px;color:var(--muted);margin-bottom:5px;display:flex;align-items:center;gap:3px}.daily-detail-value{font-size:14px;font-weight:700;color:var(--action-dark)}.daily-detail-apps{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:15px;padding:10px;background:#f8fafc;border-radius:8px;position:relative}.daily-detail-trofeu{position:absolute;right:10px;top:50%;transform:translateY(-50%);background:#fbbf24;color:#000;width:40px;height:40px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 3px 8px rgba(251,191,36,0.3)}.daily-detail-app{display:flex;flex-direction:column;align-items:center}.daily-detail-app-icon{width:25px;height:25px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;margin-bottom:5px}.daily-detail-app-icon.uber{background:#09091a;color:#fff}.daily-detail-app-icon.n99{background:#ffc300;color:#000}.daily-detail-app-icon.indrive{background:#1e90ff;color:#fff}.daily-detail-app-icon.pf{background:#334155;color:#fff}.daily-detail-app-value{font-size:14px;font-weight:700;color:var(--action-dark)}.daily-detail-resumo{display:grid;grid-template-columns:1fr 1fr;gap:10px}.daily-detail-resumo-item{display:flex;flex-direction:column;align-items:center;text-align:center;padding:12px 8px;border-radius:8px;background:#f8fafc}.daily-detail-resumo-label{font-size:10px;color:var(--muted);margin-bottom:5px}.daily-detail-resumo-value{font-size:16px;font-weight:700;color:var(--action-dark)}.chart-clickable{cursor:pointer}@media (max-width:760px){.daily-detail-card{padding:12px;max-height:60vh}.daily-detail-header{flex-direction:column;align-items:stretch}.daily-detail-lucro-header{text-align:left;margin:10px 0 0 0;font-size:22px}.daily-detail-close{position:absolute;right:15px;top:15px}.daily-detail-row{grid-template-columns:1fr 1fr;gap:6px}.daily-detail-apps{grid-template-columns:repeat(4,1fr);gap:6px}.daily-detail-app-icon{width:20px;height:20px;font-size:10px}.daily-detail-app-value{font-size:12px}.daily-detail-trofeu{width:35px;height:35px;font-size:16px}.daily-detail-resumo{grid-template-columns:1fr 1fr}}@media (max-width:480px){.daily-detail-apps{grid-template-columns:repeat(4,1fr);gap:4px;padding:8px 5px}.daily-detail-app-icon{width:18px;height:18px;font-size:9px}.daily-detail-app-value{font-size:11px}.daily-detail-trofeu{width:30px;height:30px;font-size:14px;right:5px}}

/* Novos estilos para os campos ocultos */
.hidden-field {
    display: none !important;
}

/* Estilo para o badge de RASCUNHO */
.rascunho-badge {
    background-color: var(--secondary);
    color: white;
    padding: 4px 12px;
    border-radius: 9999px;
    font-size: 12px;
    font-weight: 600;
    display: inline-block;
}

/* Animação de piscar para a bolinha verde */
@keyframes piscar {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

.jornada-card.rascunho::before {
    background: var(--secondary);
    animation: piscar 1s infinite;
}

/* BARRA DE STATUS ONLINE */
#onlineStatusBar {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 60px;
    background: white;
    border-top: 1px solid #e5e7eb;
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 9999;
    box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
}

.online-bar__content {
    font-weight: 700;
    font-size: 18px;
    color: var(--action-dark);
    text-transform: uppercase;
    letter-spacing: 1px;
}

.online-bar__progress-container {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 2px;
    background: #e5e7eb;
    overflow: hidden;
}

.online-bar__progress {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 30%;
    background: var(--secondary);
    animation: progress-animation 2s linear infinite;
}

@keyframes progress-animation {
    0% {
        left: -30%;
    }
    100% {
        left: 100%;
    }
}

/* Estilos para o modal de backup/importação */
#modalBackup {
    max-width: 500px;
    width: 90%;
}

.backup-options {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin: 20px 0;
}

.backup-option {
    display: flex;
    flex-direction: column;
    padding: 20px;
    border: 2px solid #e2e8f0;
    border-radius: 12px;
    background: #f8fafc;
    cursor: pointer;
    transition: all 0.3s ease;
}

.backup-option:hover {
    border-color: var(--secondary);
    background: #f0f9f0;
    transform: translateY(-2px);
}

.backup-option-header {
    display: flex;
    align-items: center;
    gap: 15px;
    margin-bottom: 10px;
}

.backup-option-icon {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    background: var(--secondary);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
}

.backup-option-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--action-dark);
}

.backup-option-description {
    font-size: 14px;
    color: var(--muted);
    line-height: 1.5;
}

.restore-warning {
    background: #fee2e2;
    border: 1px solid #fca5a5;
    border-radius: 8px;
    padding: 15px;
    margin: 20px 0;
    font-size: 14px;
    color: #dc2626;
}

.restore-warning i {
    margin-right: 8px;
}

.file-input-container {
    margin: 20px 0;
}

.file-input-label {
    display: block;
    padding: 15px;
    border: 2px dashed #cbd5e1;
    border-radius: 12px;
    text-align: center;
    cursor: pointer;
    transition: all 0.3s ease;
}

.file-input-label:hover {
    border-color: var(--secondary);
    background: #f0f9f0;
}

.file-input-label i {
    font-size: 40px;
    color: var(--secondary);
    margin-bottom: 10px;
}

.file-input-label span {
    display: block;
    font-size: 16px;
    font-weight: 600;
    color: var(--action-dark);
    margin-bottom: 5px;
}

.file-input-label small {
    font-size: 12px;
    color: var(--muted);
}

#fileInput {
    display: none;
}

.selected-file {
    background: #f0f9f0;
    border: 2px solid var(--secondary);
    border-radius: 8px;
    padding: 10px 15px;
    margin-top: 10px;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.selected-file-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.selected-file-icon {
    color: var(--secondary);
    font-size: 20px;
}

.selected-file-name {
    font-size: 14px;
    font-weight: 600;
    color: var(--action-dark);
}

.remove-file {
    background: transparent;
    border: none;
    color: var(--action-red);
    cursor: pointer;
    font-size: 16px;
}

.backup-progress {
    margin: 20px 0;
}

.progress-bar {
    height: 8px;
    background: #e2e8f0;
    border-radius: 4px;
    overflow: hidden;
    margin-bottom: 10px;
}

.progress-fill {
    height: 100%;
    background: var(--secondary);
    border-radius: 4px;
    width: 0%;
    transition: width 0.3s ease;
}

.progress-text {
    font-size: 14px;
    color: var(--muted);
    text-align: center;
}

@media (max-width: 760px) {
    #modalBackup {
        width: 95%;
        padding: 20px;
    }
    
    .backup-option {
        padding: 15px;
    }
    
    .backup-option-icon {
        width: 40px;
        height: 40px;
        font-size: 16px;
    }
    
    .backup-option-title {
        font-size: 16px;
    }
}
</style>
</head>
<body>
<div class="container" id="dashboard">
<!-- BARRA DE STATUS ONLINE -->
<div id="onlineStatusBar">
    <div class="online-bar__progress-container">
        <div class="online-bar__progress"></div>
    </div>
    <div class="online-bar__content">ONLINE</div>
</div>

<div id="flashOverlay">
<div id="flashIcon"></div>
<h2 id="flashText"></h2>
<div class="flash-overlay-content" id="flashModern" style="display:none">
<div class="flash-success-icon"><i class="fa-solid fa-check"></i></div>
<h2 id="flashModernTitle">Sucesso!</h2>
<p id="flashModernMessage">Operação realizada com sucesso.</p>
</div>
<div class="modal-content" id="modalConscienciaZerar" style="display:none">
<h2>ZERAR APLICATIVO</h2>
<div class="consciencia-text"><p>Ao clicar em **APAGAR TUDO**, todos os seus dados de registro, jornadas salvas e rascunhos serão **permanentemente removidos** do seu dispositivo. Esta ação é irreversível.</p><p>Somente os dados de GNV serão mantidos para um novo uso.</p></div>
<div class="modal-actions"><button class="btn-cancel" onclick="fecharModalConscienciaZerar()">CANCELAR</button><button class="btn-confirm-apagar" onclick="confirmarZerarTudo()">APAGAR TUDO</button></div>
</div>
<div class="modal-content" id="modalRegistroJornada" style="display:none">
<div class="modal-jornada-header">
<div class="modal-jornada-header-title">INSERIR JORNADA</div>
<button class="modal-jornada-header-close" onclick="fecharModalRegistro()"><i class="fa-solid fa-xmark"></i></button>
</div>
<div class="modal-jornada-content">
<div class="input-card-group" style="padding:15px 0;border:none;background:transparent;margin-bottom:0">
<input type="hidden" id="trechoIndexToEdit" value="-1">
<input type="hidden" id="originalExibitionDay" value="">
<input type="date" id="dataJornada" class="input-field-style" required>
<div class="input-group-row">
<div style="flex:1"><div class="input-icon-wrap"><input type="number" id="kmInicialTrecho" placeholder="KM Inicial" required class="input-field-style"></div></div>
<div style="flex:1"><div class="input-icon-wrap"><input type="time" id="horaInicialTrecho" required class="input-field-style"></div></div>
</div>
<div class="input-group-row hidden-field" id="camposExtras">
<div style="flex:1"><div class="input-icon-wrap"><input type="number" id="kmFinalTrecho" placeholder="KM Final" class="input-field-style"></div></div>
<div style="flex:1"><div class="input-icon-wrap"><input type="time" id="horaFinalTrecho" class="input-field-style"></div></div>
</div>
</div>
<div class="input-card-group hidden-field" style="background:transparent;padding:10px 0;border:none" id="camposGanhos">
<h5 style="font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 15px; text-transform: uppercase; color: var(--action-dark);">
  <i class="fa-solid fa-hand-holding-dollar"></i> GANHOS POR APP
</h5>
<div class="input-group-row" style="flex-wrap:wrap;margin-bottom:0">
<div class="ganho-input-row"><div class="icon-circle icon-uber-form">U</div><div class="input-icon-wrap"><input type="number" id="ganhoUber" placeholder="Uber R$" value="0" class="input-field-style"></div></div>
<div class="ganho-input-row"><div class="icon-circle icon-99-form">99</div><div class="input-icon-wrap"><input type="number" id="ganho99" placeholder="99 R$" value="0" class="input-field-style"></div></div>
</div>
<div class="input-group-row" style="flex-wrap:wrap;margin-top:10px">
<div class="ganho-input-row"><div class="icon-circle icon-indrive-form">In</div><div class="input-icon-wrap"><input type="number" id="ganhoIndrive" placeholder="In R$" value="0" class="input-field-style"></div></div>
<div class="ganho-input-row"><div class="icon-circle icon-pf-form">PF</div><div class="input-icon-wrap"><input type="number" id="ganhoPF" placeholder="PF R$" value="0" class="input-field-style"></div></div>
</div>
</div>
<div id="modalActions"><button id="btnSalvarRascunho" onclick="salvarRascunho()">GUARDAR</button><button id="btnPublicarJornada" onclick="publicarJornada()"><i class="fa-solid fa-up-right-from-square"></i> ENCERRAR</button></div>
</div>
</div>
<div class="modal-content" id="modalConfiguracao" style="display:none">
<div class="modal-header-banner">CONFIGURAÇÃO GNV</div>
<button style="position:absolute;top:15px;right:30px;background:transparent;border:none;font-size:24px;color:white;cursor:pointer;z-index:1001" onclick="fecharModalConfiguracao()"><i class="fa-solid fa-xmark"></i></button>
<div class="input-card-group" style="background:transparent;padding:10px 0;border:none">
<h5><i class="fa-solid fa-gas-pump"></i> Parâmetros de Custo</h5>
<div class="input-group-row">
<div style="flex:1">
<b>VALOR M³</b>
<label for="configPrecoGNV">Valor m³<span>(R$/m³)</span>:</label>
<div class="input-icon-wrap"><i class="fa-solid fa-gas-pump input-icon"></i><input type="number" id="configPrecoGNV" placeholder="Ex:4.79" value="4.79" max="9.99" step="0.01"></div>
</div>
<div style="flex:1">
<b>MÉDIA POR KM</b>
<label for="configMediaGNV">Média m³<span>(Km/m³)</span>:</label>
<div class="input-icon-wrap"><i class="fa-solid fa-route input-icon"></i><input type="number" id="configMediaGNV" placeholder="Ex:18.00" value="18.00" maxlength="5" max="99.99" step="0.01" oninput="if(this.value.length>this.maxLength)this.value=this.value.slice(0,this.maxLength);"></div>
</div>
</div>
</div>
<div id="modalConfigActions"><button id="btnSalvarConfig" onclick="salvarConfiguracaoGNV()">SALVAR</button></div>
</div>
<div class="modal-content" id="modalMetas" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Definir Metas</span><div class="modal-header-meta-right"><label class="switch"><input type="checkbox" id="toggleEditMetas"><span class="slider round"></span></label><button class="close-meta-modal" onclick="fecharModalMetas()"><i class="fa-solid fa-xmark"></i></button></div></div>
<div class="metas-container">
<div class="meta-item"><div class="dia-semana">Segunda</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-segunda" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Terça</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-terca" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Quarta</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-quarta" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Quinta</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-quinta" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Sexta</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-sexta" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Sábado</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-sabado" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
<div class="meta-item"><div class="dia-semana">Domingo</div><div class="meta-input-group"><div class="meta-valor"><input type="number" id="meta-domingo" placeholder="250,00" step="0.01" min="0" value="250.00" disabled></div></div></div>
</div>
<div class="meta-actions"><button id="btnSalvarTodasMetas" onclick="salvarTodasMetas()">SALVAR</button><button id="btnLimparMetas" onclick="limparTodasMetas()">LIMPAR</button></div>
</div>
<div class="modal-content" id="modalRelatorio" style="display:none">
<div class="modal-relatorio-header"><span class="relatorio-header-title">Acompanhe sua meta</span><button class="close-meta-modal" onclick="fecharModalRelatorio()"><i class="fa-solid fa-xmark"></i></button></div><p></p>
<div class="relatorio-meta-container">
<div class="relatorio-meta-info"><div class="relatorio-data" id="relatorio-data">24 DE NOVEMBRO | SEGUNDA</div><div class="relatorio-meta-valor" id="relatorio-meta-valor">R$ 0,00</div></div>
<div class="relatorio-meta-grafico" id="relatorio-meta-grafico"><div class="relatorio-meta-grafico-circle"><span id="relatorio-meta-porcentagem">0%</span></div></div>
</div>
<div class="relatorio-container">
<div class="relatorio-grid-3-colunas">
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-money-bill-wave"></i><span>Bruto</span></div><div class="relatorio-item-value" id="relatorio-bruto"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-piggy-bank"></i><span>Lucro</span></div><div class="relatorio-item-value positive" id="relatorio-lucro"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-percentage"></i><span>Margem</span></div><div class="relatorio-item-value positive" id="relatorio-margem">0%</div></div>
</div>
<div class="relatorio-linha-cinza">
<div class="relatorio-grid-3-colunas">
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-regular fa-clock"></i><span>Horas</span></div><div class="relatorio-item-value" id="relatorio-horas">00:00</div></div>
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-road"></i><span>KM Total</div><div class="relatorio-item-value" id="relatorio-km">0</div></div>
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-pause"></i><span>Intervalos</span></div><div class="relatorio-item-value" id="relatorio-intervalos">00:00</div></div>
</div>
</div>
<div class="relatorio-grid-3-colunas">
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-dollar-sign"></i><span>R$/KM</span></div><div class="relatorio-item-value" id="relatorio-reais-km"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-item-simples"><div class="relatorio-item-label"><i class="fa-solid fa-clock"></i><span>R$/Hora</span></div><div class="relatorio-item-value" id="relatorio-reais-hora"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-item-simples"></div>
</div>
<div class="relatorio-divider-green-full"></div>
<div class="relatorio-section-cinza">
<div class="relatorio-despesas-section">
<div class="relatorio-despesas-title">Despesas e Gastos</div>
<div class="relatorio-despesas-grid">
<div class="relatorio-despesa-item"><div class="relatorio-despesa-label"><i class="fa-solid fa-gas-pump"></i><span>Gasto GNV</span></div><div class="relatorio-despesa-value negative" id="relatorio-gasto-gnv"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-despesa-item"><div class="relatorio-despesa-label"><i class="fa-solid fa-fire"></i><span>m³ GNV</span></div><div class="relatorio-despesa-value" id="relatorio-m3-gnv">0,00</div></div>
<div class="relatorio-despesa-item"><div class="relatorio-despesa-label"><i class="fa-solid fa-receipt"></i><span>Outros</span></div><div class="relatorio-despesa-value negative" id="relatorio-outros-gastos"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-despesa-item"><div class="relatorio-despesa-label"><i class="fa-solid fa-calculator"></i><span>Total</span></div><div class="relatorio-despesa-value negative" id="relatorio-total-despesas"><span class="currency-symbol">R$</span>0,00</div></div>
</div>
</div>
<div class="relatorio-divider-green-full"></div>
<div class="relatorio-section">
<div class="relatorio-section-title"><i class="fa-solid fa-bullseye"></i><span>Para Bater a Meta</span></div>
<div class="relatorio-falta-meta">
<div class="relatorio-falta-item"><div class="relatorio-falta-label">Falta em R$</div><div class="relatorio-falta-value" id="relatorio-falta-reais">R$0,00</div></div>
<div class="relatorio-falta-item"><div class="relatorio-falta-label">Falta em Horas</div><div class="relatorio-falta-value" id="relatorio-falta-horas">00:00</div></div>
<div class="relatorio-falta-item"><div class="relatorio-falta-label">Falta em GNV (R$)</div><div class="relatorio-falta-value" id="relatorio-falta-gnv">R$0,00</div></div>
</div>
<div class="relatorio-meta-info">
<div class="relatorio-meta-progress"><div class="relatorio-meta-progress-fill" id="relatorio-progresso-meta" style="width:0%"></div></div>
<div class="relatorio-meta-stats"><span id="relatorio-progresso-texto">0%</span><span id="relatorio-horas-faltantes">--</span></div>
</div>
</div>
<div class="relatorio-divider-green-full"></div>
<div class="relatorio-section">
<div class="relatorio-section-title"><i class="fa-solid fa-mobile-screen-button"></i><span>Distribuição por App</span></div>
<div class="relatorio-apps-grid">
<div class="relatorio-app-item"><div class="relatorio-app-icon uber">U</div><div class="relatorio-app-value" id="relatorio-uber"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-app-item"><div class="relatorio-app-icon n99">99</div><div class="relatorio-app-value" id="relatorio-99"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-app-item"><div class="relatorio-app-icon indrive">In</div><div class="relatorio-app-value" id="relatorio-indrive"><span class="currency-symbol">R$</span>0,00</div></div>
<div class="relatorio-app-item"><div class="relatorio-app-icon pf">PF</div><div class="relatorio-app-value" id="relatorio-pf"><span class="currency-symbol">R$</span>0,00</div></div>
</div>
</div>
</div>
</div>
</div>
<div class="modal-content" id="modalDespesas" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Gastos e Despesas</span><button class="close-meta-modal" onclick="fecharModalDespesas()"><i class="fa-solid fa-xmark"></i></button></div>
<div class="despesas-container">
<div class="despesas-tipo-principal">
<div class="despesas-tipo-coluna" id="tipoPessoal" onclick="selecionarTipoDespesa('pessoal')"><div class="despesas-tipo-icone"><i class="fa-solid fa-user"></i></div><div class="despesas-tipo-label">Pessoal</div></div>
<div class="despesas-tipo-coluna" id="tipoVeiculo" onclick="selecionarTipoDespesa('veiculo')"><div class="despesas-tipo-icone"><i class="fa-solid fa-car"></i></div><div class="despesas-tipo-label">Veículo</div></div>
</div>
<div class="despesas-form-section" id="secaoPessoal">
<div class="despesas-form-header"><h4 class="despesas-form-title">Despesas Pessoais</h4><div class="despesas-botoes-acao"><button class="btn-inserir-despesa" onclick="mostrarFormularioDespesaPessoal()"><i class="fa-solid fa-plus"></i>Inserir Despesa</button><button class="btn-lupa" onclick="abrirModalPesquisaDespesas('pessoal')"><i class="fa-solid fa-search"></i></button></div></div>
<div class="despesas-formulario" id="formularioPessoal">
<div class="despesas-form-row"><input type="date" id="despesaPessoalData" class="despesas-form-input" value=""></div>
<div class="despesas-form-row"><select id="despesaPessoalCategoria" class="despesas-form-select"><option value="">Selecione a categoria</option><option value="comida">Comida</option><option value="bebida">Bebida</option><option value="internet">Internet</option><option value="outros">Outros</option></select></div>
<div class="despesas-form-row"><input type="text" id="despesaPessoalDescricao" class="despesas-form-input" placeholder="Descrição (opcional)"></div>
<div class="despesas-form-row"><input type="number" id="despesaPessoalValor" class="despesas-form-input" placeholder="Valor (R$)" step="0.01" min="0"></div>
<div class="despesas-form-actions"><button class="despesas-form-btn cancel" onclick="cancelarDespesaPessoal()">CANCELAR</button><button class="despesas-form-btn save" onclick="salvarDespesaPessoal()">SALVAR</button></div>
</div>
<div class="despesas-lista" id="listaDespesasPessoal"><div class="despesa-empty"><i class="fa-solid fa-receipt"></i><p>Nenhuma despesa pessoal registrada</p></div></div>
<div class="despesas-total"><div class="despesas-total-label">Total Pessoal:</div><div class="despesas-total-value" id="totalDespesasPessoal">R$0,00</div></div>
</div>
<div class="despesas-form-section" id="secaoVeiculo">
<div class="despesas-form-header"><h4 class="despesas-form-title">Despesas do Veículo</h4><div class="despesas-botoes-acao"><button class="btn-inserir-despesa" onclick="mostrarFormularioDespesaVeiculo()"><i class="fa-solid fa-plus"></i>Inserir Despesa</button><button class="btn-lupa" onclick="abrirModalPesquisaDespesas('veiculo')"><i class="fa-solid fa-search"></i></button><button class="btn-config" onclick="abrirModalConfigDespesasVeiculo()"><i class="fa-solid fa-gear"></i></button></div></div>
<div class="despesas-formulario" id="formularioVeiculo">
<div class="despesas-form-row"><input type="date" id="despesaVeiculoData" class="despesas-form-input" value=""></div>
<div class="despesas-form-row"><select id="despesaVeiculoCategoria" class="despesas-form-select" onchange="mudarCategoriaVeiculo(this.value)"><option value="">Selecione a categoria</option><option value="combustivel">Combustível</option><option value="oleo">Óleo</option><option value="manutencao">Manutenção</option><option value="lavagem">Lavagem</option><option value="outros">Outros</option></select></div>
<div class="campos-especificos" id="camposCombustivel">
<div class="combustivel-opcoes">
<div class="combustivel-opcao" onclick="selecionarCombustivel('GNV')"><div class="combustivel-icon"><i class="fa-solid fa-gas-pump"></i></div><div class="combustivel-nome">GNV</div><div class="combustivel-unidade">m³</div></div>
<div class="combustivel-opcao" onclick="selecionarCombustivel('Gasolina')"><div class="combustivel-icon"><i class="fa-solid fa-fire"></i></div><div class="combustivel-nome">Gasolina</div><div class="combustivel-unidade">litros</div></div>
<div class="combustivel-opcao" onclick="selecionarCombustivel('Etanol')"><div class="combustivel-icon"><i class="fa-solid fa-leaf"></i></div><div class="combustivel-nome">Etanol</div><div class="combustivel-unidade">litros</div></div>
</div>
<input type="hidden" id="despesaVeiculoCombustivelTipo" value="">
<div class="combustivel-odometro">
<div class="despesas-form-row"><input type="number" id="despesaVeiculoCombustivelOdometroInicial" class="despesas-form-input" placeholder="Odômetro inicial (opcional)" step="0.01" min="0"></div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoCombustivelOdometroFinal" class="despesas-form-input" placeholder="Odômetro final (opcional)" step="0.01" min="0"></div>
</div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoCombustivelPrecoUnitario" class="despesas-form-input" placeholder="Preço Unitário (R$)" step="0.001" min="0" oninput="calcularCombustivel()"></div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoCombustivelValorTotal" class="despesas-form-input" placeholder="Valor Total (R$)" step="0.01" min="0" oninput="calcularCombustivel()"></div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoCombustivelQuantidade" class="despesas-form-input" placeholder="Quantidade (calculada)" step="0.001" min="0" readonly></div>
</div>
<div class="campos-especificos" id="camposOleo">
<div class="despesas-form-row"><input type="number" id="despesaVeiculoOleoKmAtual" class="despesas-form-input" placeholder="KM da troca" step="0.01" min="0" oninput="verificarAlertaOleo()"></div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoOleoProximaTroca" class="despesas-form-input" placeholder="Próxima troca em (km)" step="0.01" min="0" oninput="verificarAlertaOleo()"></div>
<div class="oleo-alerta" id="oleoAlerta">Faltam <span id="kmRestantesOleo">0</span> km para a próxima troca!</div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoOleoValor" class="despesas-form-input" placeholder="Valor pago (R$)" step="0.01" min="0"></div>
</div>
<div class="campos-especificos" id="camposManutencao">
<div class="despesas-form-row"><input type="text" id="despesaVeiculoManutencaoDescricao" class="despesas-form-input" placeholder="Descrição do serviço"></div>
<div class="despesas-form-row"><select id="despesaVeiculoManutencaoPagamento" class="despesas-form-select" onchange="mudarFormaPagamentoManutencao(this.value)"><option value="avista">À vista</option><option value="cartao">Cartão (parcelado)</option></select></div>
<div class="campos-especificos" id="camposParcelamento">
<div class="despesas-form-row"><input type="number" id="despesaVeiculoManutencaoParcelas" class="despesas-form-input" placeholder="Número de parcelas" min="1" max="12" oninput="calcularParcelasManutencao()"></div>
<div class="despesas-form-row"><input type="date" id="despesaVeiculoManutencaoDataPrimeiraParcela" class="despesas-form-input" onchange="calcularParcelasManutencao()"></div>
<div class="manutencao-parcelas" id="listaParcelasManutencao"></div>
</div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoManutencaoValor" class="despesas-form-input" placeholder="Valor total (R$)" step="0.01" min="0" oninput="calcularParcelasManutencao()"></div>
</div>
<div class="campos-especificos" id="camposOutrosVeiculo">
<div class="despesas-form-row"><input type="text" id="despesaVeiculoOutrosDescricao" class="despesas-form-input" placeholder="Descrição (opcional)"></div>
<div class="despesas-form-row"><input type="number" id="despesaVeiculoOutrosValor" class="despesas-form-input" placeholder="Valor (R$)" step="0.01" min="0"></div>
</div>
<div class="despesas-form-actions"><button class="despesas-form-btn cancel" onclick="cancelarDespesaVeiculo()">CANCELAR</button><button class="despesas-form-btn save" onclick="salvarDespesaVeiculo()">SALVAR</button></div>
</div>
<div class="despesas-lista" id="listaDespesasVeiculo"><div class="despesa-empty"><i class="fa-solid fa-car"></i><p>Nenhuma despesa do veículo registrada</p></div></div>
<div class="despesas-total"><div class="despesas-total-label">Total Veículo:</div><div class="despesas-total-value" id="totalDespesasVeiculo">R$0,00</div></div>
</div>
</div>
</div>
<div class="modal-content" id="modalPesquisaDespesas" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Pesquisar Despesas</span><button class="close-meta-modal" onclick="fecharModalPesquisaDespesas()"><i class="fa-solid fa-xmark"></i></button></div>
<div class="pesquisa-filtros">
<div class="pesquisa-filtro-row"><div class="pesquisa-filtro-label">Período:</div><div class="pesquisa-datas"><input type="date" id="pesquisaDataInicio" value=""><span>até</span><input type="date" id="pesquisaDataFim" value=""></div></div>
<div class="pesquisa-filtro-row"><div class="pesquisa-filtro-label">Tipo de Despesa:</div><div class="categorias-container" id="categoriasTipo"></div></div>
<div class="pesquisa-filtro-row"><div class="pesquisa-filtro-label">Ordenar por:</div><div class="pesquisa-ordem"><div class="ordem-option" onclick="selecionarOrdemPesquisa(this,'recente')">Mais Recente</div><div class="ordem-option" onclick="selecionarOrdemPesquisa(this,'antiga')">Mais Antiga</div></div></div>
</div>
<div class="pesquisa-resultados" id="pesquisaResultados"><div class="despesa-empty"><i class="fa-solid fa-search"></i><p>Nenhuma despesa encontrada. Aplique os filtros e clique em Pesquisar.</p></div></div>
<div class="pesquisa-total" style="display:none"><span>Total Encontrado:</span><span id="pesquisaTotalValor">R$0,00</span></div>
<div class="pesquisa-acoes"><button class="pesquisar" onclick="realizarPesquisaDespesas()">PESQUISAR</button><button class="limpar" onclick="limparPesquisaDespesas()">LIMPAR FILTROS</button></div>
</div>
<div class="modal-content" id="modalConfigDespesasVeiculo" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Configurar Despesas</span><button class="close-meta-modal" onclick="fecharModalConfigDespesasVeiculo()"><i class="fa-solid fa-xmark"></i></button></div>
<div class="config-categorias">
<div class="config-categoria-item"><div class="config-categoria-info"><div class="config-categoria-icone"><i class="fa-solid fa-gas-pump"></i></div><div><div class="config-categoria-nome">Combustível</div><div class="config-categoria-desc">Incluir no cálculo da meta do dia</div></div></div><label class="config-switch"><input type="checkbox" id="configCombustivel"><span class="config-slider"></span></label></div>
<div class="config-categoria-item"><div class="config-categoria-info"><div class="config-categoria-icone"><i class="fa-solid fa-oil-can"></i></div><div><div class="config-categoria-nome">Óleo</div><div class="config-categoria-desc">Incluir no cálculo da meta do dia</div></div></div><label class="config-switch"><input type="checkbox" id="configOleo"><span class="config-slider"></span></label></div>
<div class="config-categoria-item"><div class="config-categoria-info"><div class="config-categoria-icone"><i class="fa-solid fa-screwdriver-wrench"></i></div><div><div class="config-categoria-nome">Manutenção</div><div class="config-categoria-desc">Incluir no cálculo da meta do dia</div></div></div><label class="config-switch"><input type="checkbox" id="configManutencao"><span class="config-slider"></span></label></div>
<div class="config-categoria-item"><div class="config-categoria-info"><div class="config-categoria-icone"><i class="fa-solid fa-soap"></i></div><div><div class="config-categoria-nome">Lavagem</div><div class="config-categoria-desc">Incluir no cálculo da meta do dia</div></div></div><label class="config-switch"><input type="checkbox" id="configLavagem"><span class="config-slider"></span></label></div>
<div class="config-categoria-item"><div class="config-categoria-info"><div class="config-categoria-icone"><i class="fa-solid fa-receipt"></i></div><div><div class="config-categoria-nome">Outros (Veículo)</div><div class="config-categoria-desc">Incluir no cálculo da meta do dia</div></div></div><label class="config-switch"><input type="checkbox" id="configOutrosVeiculo"><span class="config-slider"></span></label></div>
</div>
<div class="config-info"><i class="fa-solid fa-circle-info"></i><span>Quando ativado, o gasto da categoria será incluído no cálculo do lucro diário, afetando o cálculo da meta.</span></div>
<div class="pesquisa-acoes" style="margin-top:25px"><button class="pesquisar" onclick="salvarConfigDespesasVeiculo()">SALVAR CONFIGURAÇÕES</button></div>
</div>
<div class="modal-content" id="modalTemas" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Escolha seu Tema</span><button class="close-meta-modal" onclick="fecharModalTemas()"><i class="fa-solid fa-xmark"></i></button></div>
<div class="temas-container">
<div class="tema-option tema-padrao" onclick="selecionarTema('padrao')"><div class="tema-paleta"><div class="tema-cor cor-1"></div><div class="tema-cor cor-2"></div><div class="tema-cor cor-3"></div><div class="tema-cor cor-4"></div></div><div class="tema-nome">Tema Padrão</div></div>
<div class="tema-option tema-preto-amarelo" onclick="selecionarTema('preto-amarelo')"><div class="tema-paleta"><div class="tema-cor cor-1"></div><div class="tema-cor cor-2"></div><div class="tema-cor cor-3"></div><div class="tema-cor cor-4"></div></div><div class="tema-nome">Preto & Amarelo</div></div>
<div class="tema-option tema-preto-vermelho" onclick="selecionarTema('preto-vermelho')"><div class="tema-paleta"><div class="tema-cor cor-1"></div><div class="tema-cor cor-2"></div><div class="tema-cor cor-3"></div><div class="tema-cor cor-4"></div></div><div class="tema-nome">Preto & Vermelho</div></div>
<div class="tema-option tema-preto-roxo-amarelo" onclick="selecionarTema('preto-roxo-amarelo')"><div class="tema-paleta"><div class="tema-cor cor-1"></div><div class="tema-cor cor-2"></div><div class="tema-cor cor-3"></div><div class="tema-cor cor-4"></div></div><div class="tema-nome">Preto,Roxo & Amarelo</div></div>
<div class="tema-option tema-terra-verde" onclick="selecionarTema('terra-verde')"><div class="tema-paleta"><div class="tema-cor cor-1"></div><div class="tema-cor cor-2"></div><div class="tema-cor cor-3"></div><div class="tema-cor cor-4"></div></div><div class="tema-nome">Terra e Verde</div></div>
</div>
</div>
<!-- Modal para Backup/Restaurar/Importar -->
<div class="modal-content" id="modalBackup" style="display:none">
<div class="modal-header-meta"><span class="modal-meta-title">Backup e Restauração</span><button class="close-meta-modal" onclick="fecharModalBackup()"><i class="fa-solid fa-xmark"></i></button></div>
<div class="backup-options">
<div class="backup-option" onclick="fazerBackup()">
<div class="backup-option-header">
<div class="backup-option-icon"><i class="fa-solid fa-download"></i></div>
<div>
<div class="backup-option-title">Fazer Backup</div>
<div class="backup-option-description">Exporte todos os seus dados para um arquivo JSON seguro. Inclui jornadas, despesas, metas e configurações.</div>
</div>
</div>
</div>
<div class="backup-option" onclick="iniciarRestauracao()">
<div class="backup-option-header">
<div class="backup-option-icon"><i class="fa-solid fa-upload"></i></div>
<div>
<div class="backup-option-title">Restaurar Backup</div>
<div class="backup-option-description">Importe um arquivo de backup anterior para restaurar todos os seus dados.</div>
</div>
</div>
</div>
<div class="backup-option" onclick="iniciarImportacao()">
<div class="backup-option-header">
<div class="backup-option-icon"><i class="fa-solid fa-file-import"></i></div>
<div>
<div class="backup-option-title">Importar Dados</div>
<div class="backup-option-description">Importe dados específicos (jornadas, despesas ou metas) sem substituir todas as configurações.</div>
</div>
</div>
</div>
</div>
<div id="restoreSection" style="display:none">
<div class="restore-warning"><i class="fa-solid fa-triangle-exclamation"></i>Atenção: Restaurar um backup substituirá TODOS os dados atuais. Faça um backup antes de prosseguir.</div>
<div class="file-input-container">
<label class="file-input-label" for="fileInput">
<i class="fa-solid fa-cloud-upload-alt"></i>
<span>Selecionar arquivo de backup</span>
<small>Arraste ou clique para selecionar um arquivo .json</small>
</label>
<input type="file" id="fileInput" accept=".json">
<div id="selectedFile" class="selected-file" style="display:none">
<div class="selected-file-info">
<i class="fa-solid fa-file selected-file-icon"></i>
<span id="fileName">arquivo.json</span>
</div>
<button class="remove-file" onclick="removerArquivo()"><i class="fa-solid fa-times"></i></button>
</div>
</div>
<div class="backup-progress" style="display:none">
<div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>
<div class="progress-text" id="progressText">Processando...</div>
</div>
<div class="pesquisa-acoes" style="margin-top:25px">
<button class="limpar" onclick="cancelarRestauracao()">CANCELAR</button>
<button class="pesquisar" onclick="restaurarBackup()" id="btnRestaurar" disabled>RESTAURAR BACKUP</button>
</div>
</div>
<div id="importSection" style="display:none">
<div class="file-input-container">
<label class="file-input-label" for="importFileInput">
<i class="fa-solid fa-file-import"></i>
<span>Selecionar arquivo para importar</span>
<small>Arraste ou clique para selecionar um arquivo .json</small>
</label>
<input type="file" id="importFileInput" accept=".json">
<div id="selectedImportFile" class="selected-file" style="display:none">
<div class="selected-file-info">
<i class="fa-solid fa-file selected-file-icon"></i>
<span id="importFileName">arquivo.json</span>
</div>
<button class="remove-file" onclick="removerArquivoImportacao()"><i class="fa-solid fa-times"></i></button>
</div>
</div>
<div class="backup-progress" id="importProgress" style="display:none">
<div class="progress-bar"><div class="progress-fill" id="importProgressFill"></div></div>
<div class="progress-text" id="importProgressText">Processando...</div>
</div>
<div class="pesquisa-acoes" style="margin-top:25px">
<button class="limpar" onclick="cancelarImportacao()">CANCELAR</button>
<button class="pesquisar" onclick="importarDados()" id="btnImportar" disabled>IMPORTAR DADOS</button>
</div>
</div>
</div>
</div>
<div class="floating-button-container">
<div class="floating-button" onclick="abrirModalRelatorio()"><i class="fa-solid fa-rocket"></i></div>
</div>
<header>
<img id="headerImage" src="https://i.ibb.co/6RjPPtvQ/Picsart-25-10-21-14-24-37-516.jpg" alt="Topo Inicial">
<div id="headerActionsBar" class="container">
<div id="dropUpContainer"><button id="dropUpButton" onclick="toggleDropUpMenu()"><i class="fa-solid fa-bars"></i></button>
<div id="dropUpMenu">
<div class="drop-up-item" onclick="handleDropUpAction('gnv')"><i class="fa-solid fa-gas-pump"></i>Parâmetros GNV</div>
<div class="drop-up-item" onclick="handleDropUpAction('metas')"><i class="fa-solid fa-bullseye"></i>Metas</div>
<div class="drop-up-item" onclick="handleDropUpAction('despesas')"><i class="fa-solid fa-receipt"></i>Gastos e Despesas</div>
<div class="drop-up-item" onclick="handleDropUpAction('temas')"><i class="fa-solid fa-palette"></i>Temas</div>
<div class="drop-up-item divider-top" onclick="handleDropUpAction('backup')"><i class="fa-solid fa-database"></i>Backup e Restauração</div>
<div class="drop-up-item" onclick="handleDropUpAction('zerar')"><i class="fa-solid fa-trash"></i>Zerar APP</div>
<div class="drop-up-item" onclick="handleDropUpAction('salvar_img')"><i class="fa-solid fa-download"></i>Salvar Imagem</div>
</div>
</div>
</div>
</header>
<main class="grid">
<section class="card">
<div id="mainSummaryCard">
<div id="lucroDisplay">
<button id="toggleLucroBtn" onclick="toggleLucroDisplay()"><i class="fa-solid fa-eye-slash"></i></button>
<div class="lucro-rect">
<div class="value" id="lucroLiquidoTotal">R$ 0,00</div>
<div class="label" id="lucroLabel">Lucro Líquido Atual</div>
</div>
<button id="toggleLucroBrutoBtn" onclick="toggleLucroBruto()"><i class="fa-solid fa-arrow-right-arrow-left"></i></button>
</div>
<div class="summary-stats">
<div class="stat-simple"><i class="fa-solid fa-road"></i><div class="value" id="kmPercorridosTotal"><span class="value-number">0</span><span class="value-unit">km</span></div><div class="stat-label">Distância</div></div>
<div class="stat-simple"><i class="fa-regular fa-clock"></i><div class="value" id="horasDirigidasTotal">—</div><div class="stat-label">Tempo</div></div>
<div class="stat-simple"><i class="fa-solid fa-dollar-sign"></i><div class="value" id="reaisPorKmTotal"><span class="value-currency">R$</span><span class="value-number">0,00</span></div><div class="stat-label">R$/KM</div></div>
<div class="stat-simple"><i class="fa-solid fa-clock"></i><div class="value" id="reaisPorHoraTotal"><span class="value-currency">R$</span><span class="value-number">0,00</span></div><div class="stat-label">R$/HR</div></div>
</div>
</div>
<button id="btnInserirJornada" onclick="abrirModalRegistro(-1)">INSERIR JORNADA</button>
</section>
<section class="card" id="weeklyProfitChartCard">
<h3><span class="icon-circle-profit"><i class="fa-solid fa-dollar-sign"></i></span>Lucro Semanal</h3>
<div class="weekly-nav-bar">
<button onclick="changeWeek(-1)"><i class="fa-solid fa-chevron-left"></i></button>
<div class="weekly-summary">
<div class="label" id="weeklyDateRange">Semana Atual</div>
<div class="value" id="weeklyTotalProfit">R$ 0,00</div>
</div>
<button id="nextWeekBtn" onclick="changeWeek(1)"><i class="fa-solid fa-chevron-right"></i></button>
</div>
<div id="weeklyProfitChartContainer"><canvas id="weeklyProfitChart" class="chart-clickable"></canvas></div>
<div id="dailyDetailCard" class="daily-detail-card">
<div class="daily-detail-header">
<div class="daily-detail-header-left">
<div class="daily-detail-title"><i class="fa-solid fa-calendar-day"></i>Relatório Diário</div>
<div class="daily-detail-date" id="detailDateFormatted">12/10/2005 - Quarta-feira</div>
</div>
<div class="daily-detail-lucro-header" id="detailLucroHeader">R$ 0,00</div>
<button class="daily-detail-close" onclick="hideDailyDetail()"><i class="fa-solid fa-arrow-left"></i></button>
</div>
<div class="daily-detail-content">
<div class="daily-detail-row">
<div class="daily-detail-item"><div class="daily-detail-label"><i class="fa-solid fa-clock"></i>Reais por Hora</div><div class="daily-detail-value" id="detailReaisHora">R$0,00</div></div>
<div class="daily-detail-item"><div class="daily-detail-label"><i class="fa-solid fa-road"></i>Reais por KM</div><div class="daily-detail-value" id="detailReaisKm">R$0,00</div></div>
<div class="daily-detail-item"><div class="daily-detail-label"><i class="fa-solid fa-hourglass-half"></i>Horas Trabalhadas</div><div class="daily-detail-value" id="detailHoras">00:00</div></div>
<div class="daily-detail-item"><div class="daily-detail-label"><i class="fa-solid fa-route"></i>KM Total</div><div class="daily-detail-value" id="detailKm">0</div></div>
</div>
<div class="daily-detail-apps">
<div class="daily-detail-app"><div class="daily-detail-app-icon uber">U</div><div class="daily-detail-app-value" id="detailUber">R$0,00</div></div>
<div class="daily-detail-app"><div class="daily-detail-app-icon n99">99</div><div class="daily-detail-app-value" id="detail99">R$0,00</div></div>
<div class="daily-detail-app"><div class="daily-detail-app-icon indrive">In</div><div class="daily-detail-app-value" id="detailIndrive">R$0,00</div></div>
<div class="daily-detail-app"><div class="daily-detail-app-icon pf">PF</div><div class="daily-detail-app-value" id="detailPF">R$0,00</div></div>
</div>
<div class="daily-detail-resumo">
<div class="daily-detail-resumo-item"><div class="daily-detail-resumo-label">Valor Bruto</div><div class="daily-detail-resumo-value" id="detailBruto">R$0,00</div></div>
<div class="daily-detail-resumo-item"><div class="daily-detail-resumo-label">Meta do Dia</div><div class="daily-detail-resumo-value" id="detailMeta">R$0,00</div></div>
</div>
</div>
</div>
</section>
<section class="card" id="jornadasSalvasCard">
<div class="jornadas-header-container">
<h3><span class="icon-circle-profit"><i class="fa-solid fa-route"></i></span>Jornadas do Dia</h3>
<button class="sort-toggle-btn" id="sortToggleBtn" onclick="toggleSortOrder()" title="Ordenar"><i class="fa-solid fa-sort" id="sortIcon"></i></button>
</div>
<div class="daily-date-navigator">
<button onclick="changeDay(-1)"><i class="fa-solid fa-chevron-left"></i></button>
<div class="date-display" id="dailyDateDisplay">Carregando...</div>
<button id="nextDayBtn" onclick="changeDay(1)"><i class="fa-solid fa-chevron-right"></i></button>
</div>
<div class="jornadas-grid" id="trechosList">
<p style="text-align:center;color:var(--muted);padding:20px;grid-column:1/-1">Nenhuma jornada publicada ou rascunho salvo ainda.</p>
</div>
<p style="text-align:center;margin-top:25px;font-size:14px;color:var(--dark-gray)">Total de Jornadas: <span id="totalTrechos">0</span></p>
</section>
</main>
<footer><strong style="color:var(--primary)">Motorizze APP</strong><span style="color:var(--action-dark)">2025</span></footer>
</div>
<script>
let isLucroVisible=true,diaExibido='',weeklyChart=null,currentWeekStartDate=null,isShowingLucroLiquido=true,metas={},despesas={pessoal:{},veiculo:{}},despesaEditando=null,tipoDespesaSelecionado=null,tipoCombustivelSelecionado='GNV',pesquisaTipoAtual='pessoal',categoriasSelecionadasPesquisa=[],ordemPesquisa='recente',configDespesasVeiculo={},currentWeeklyData=[],sortOrder='recente';
const TODAY_DATE_STRING=getTodayDate(),meses=["janeiro","fevereiro","março","abril","maio","junho","julho","agosto","setembro","outubro","novembro","dezembro"],diasDaSemanaGrafico=["SEG","TER","QUA","QUI","SEX","SÁB","DOM"],DATA_STORAGE_KEY='dailyReportsData_v4',METAS_STORAGE_KEY='metasDiarias',METAS_DIARIAS_STORAGE_KEY='metasDiariasPorDia',DESPESAS_STORAGE_KEY='despesasDiarias_v2',CONFIG_DESPESAS_KEY='configDespesasVeiculo',TEMA_STORAGE_KEY='temaAplicativo';
let relatoriosDiarios={},dadosDoDiaExibido=null,configGNVSource='menu';

// Variáveis para backup
let backupFile = null;
let importFile = null;

function getTodayDate(){const today=new Date();return `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;}
function formatDateToDisplay(dateString){const parts=dateString.split('-');return `${parts[2]}/${parts[1]}/${parts[0]}`;}
function formatDateToLongDisplay(dateString){const parts=dateString.split('-');return `${parseInt(parts[2])} de ${meses[parseInt(parts[1])-1]} de ${parts[0]}`;}
function formatarDataParaRelatorio(dateString){const date=new Date(dateString+'T00:00:00'),dia=date.getDate(),mes=meses[date.getMonth()].toUpperCase(),diasDaSemana=['DOMINGO','SEGUNDA','TERÇA','QUARTA','QUINTA','SEXTA','SÁBADO'],diaSemana=diasDaSemana[date.getDay()];return `${dia} DE ${mes} | ${diaSemana}`;}
function formatDateToKey(date){return `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;}
function calcularDiferencaHoras(horaInicial,horaFinal){if(!horaInicial||!horaFinal)return 0;const [h1,m1]=horaInicial.split(':').map(Number),[h2,m2]=horaFinal.split(':').map(Number);let totalMinutos1=h1*60+m1,totalMinutos2=h2*60+m2;if(totalMinutos2<totalMinutos1)totalMinutos2+=24*60;const diferencaMinutos=totalMinutos2-totalMinutos1;return diferencaMinutos<0?0:diferencaMinutos/60;}
function decimalParaHorasHHMM(decimal){const totalMinutos=Math.round(decimal*60),horas=Math.floor(totalMinutos/60),minutos=totalMinutos%60;return `${String(horas).padStart(2,'0')}:${String(minutos).padStart(2,'0')}`;}
function decimalParaHoras(decimal){const totalMinutos=Math.round(decimal*60);return `${Math.floor(totalMinutos/60)}h ${totalMinutos%60}min`;}
function ensureDailyDataStructure(dateKey,forceNew=false){const lastDate=Object.keys(relatoriosDiarios).sort().pop();let precoGNV=4.79,mediaGNV=18.00;if(lastDate&&relatoriosDiarios[lastDate]){precoGNV=relatoriosDiarios[lastDate].precoGNV||4.79;mediaGNV=relatoriosDiarios[lastDate].mediaGNV||18.00;}
const metasDiarias=carregarMetasDiarias(),metaDia=obterMetaDoDia(dateKey);if(!relatoriosDiarios[dateKey]||forceNew){relatoriosDiarios[dateKey]={date:dateKey,precoGNV,mediaGNV,trechos:[]};}else{relatoriosDiarios[dateKey].precoGNV=relatoriosDiarios[dateKey].precoGNV||precoGNV;relatoriosDiarios[dateKey].mediaGNV=relatoriosDiarios[dateKey].mediaGNV||mediaGNV;}
relatoriosDiarios[dateKey].metaDia=metaDia;return relatoriosDiarios[dateKey];}
function salvarDados(){if(dadosDoDiaExibido)relatoriosDiarios[dadosDoDiaExibido.date]=dadosDoDiaExibido;localStorage.setItem(DATA_STORAGE_KEY,JSON.stringify(relatoriosDiarios));}
function carregarDados(){const dataJSON=localStorage.getItem(DATA_STORAGE_KEY);relatoriosDiarios=dataJSON?JSON.parse(dataJSON):{};diaExibido=TODAY_DATE_STRING;dadosDoDiaExibido=ensureDailyDataStructure(diaExibido);return relatoriosDiarios;}
function carregarMetas(){const metasJSON=localStorage.getItem(METAS_STORAGE_KEY);metas=metasJSON?JSON.parse(metasJSON):{};return metas;}
function salvarMetas(){localStorage.setItem(METAS_STORAGE_KEY,JSON.stringify(metas));}
function carregarMetasDiarias(){const metasDiariasJSON=localStorage.getItem(METAS_DIARIAS_STORAGE_KEY);return metasDiariasJSON?JSON.parse(metasDiariasJSON):{};}
function salvarMetasDiarias(metasDiarias){localStorage.setItem(METAS_DIARIAS_STORAGE_KEY,JSON.stringify(metasDiarias));}
function obterMetaDoDia(dateKey){const metasDiarias=carregarMetasDiarias();if(metasDiarias[dateKey]){return metasDiarias[dateKey];}
const dateObj=new Date(dateKey+'T00:00:00'),diaSemana=dateObj.getDay(),dias=['domingo','segunda','terca','quarta','quinta','sexta','sabado'],diaAtual=dias[diaSemana];return metas[diaAtual]||250.00;}
function carregarEExibirDados(dateKey){diaExibido=dateKey;dadosDoDiaExibido=ensureDailyDataStructure(dateKey);atualizarUI();}
function mostrarFlashModerno(titulo,mensagem){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('flash-mode');document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('flashModern').style.display='block';document.getElementById('flashModernTitle').textContent=titulo;document.getElementById('flashModernMessage').textContent=mensagem;flashOverlay.style.backgroundColor='rgba(255,255,255,0.95)';flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);return new Promise(resolve=>{setTimeout(()=>{flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('flashModern').style.display='none';resolve();},500);},1500);});}
function mostrarFlashTemporario(iconHtml,text,colorRGB){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('flash-mode');document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('flashIcon').style.display='block';document.getElementById('flashText').style.display='block';document.getElementById('flashIcon').innerHTML=iconHtml;document.getElementById('flashText').innerHTML=text;flashOverlay.style.backgroundColor=`rgba(${colorRGB},0.95)`;flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);return new Promise(resolve=>{setTimeout(()=>{flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';resolve();},500);},1500);});}
function toggleDropUpMenu(){const menu=document.getElementById('dropUpMenu');menu.classList.toggle('open');if(menu.classList.contains('open')){document.addEventListener('click',closeDropUpMenuOutside);}else{document.removeEventListener('click',closeDropUpMenuOutside);}}
function closeDropUpMenu(){document.getElementById('dropUpMenu').classList.remove('open');document.removeEventListener('click',closeDropUpMenuOutside);}
function closeDropUpMenuOutside(event){const container=document.getElementById('dropUpContainer');if(!container.contains(event.target))closeDropUpMenu();}
function handleDropUpAction(action){closeDropUpMenu();switch(action){case'gnv':abrirModalConfiguracaoGNV('menu');break;case'metas':abrirModalMetas();break;case'despesas':abrirModalDespesas();break;case'temas':abrirModalTemas();break;case'backup':abrirModalBackup();break;case'zerar':abrirModalConscienciaZerar();break;case'salvar_img':salvarImagem();break;}}
function toggleSortOrder(){sortOrder=sortOrder==='recente'?'antiga':'recente';const sortBtn=document.getElementById('sortToggleBtn'),sortIcon=document.getElementById('sortIcon');if(sortOrder==='recente'){sortIcon.className='fa-solid fa-arrow-up';sortBtn.classList.remove('active');}else{sortIcon.className='fa-solid fa-arrow-down';sortBtn.classList.add('active');}
atualizarDisplayTrechos();}
function showDailyDetail(dateKey){const detailCard=document.getElementById('dailyDetailCard'),chartContainer=document.getElementById('weeklyProfitChartContainer');chartContainer.style.display='none';detailCard.classList.add('show');const dailyData=ensureDailyDataStructure(dateKey),totais=calcularTotaisDoDia(dailyData),metaDia=obterMetaDoDia(dateKey),bateuMeta=totais.lucroLiquido>=metaDia,dateObj=new Date(dateKey+'T00:00:00'),dia=String(dateObj.getDate()).padStart(2,'0'),mes=String(dateObj.getMonth()+1).padStart(2,'0'),ano=dateObj.getFullYear(),diasDaSemana=['Domingo','Segunda-feira','Terça-feira','Quarta-feira','Quinta-feira','Sexta-feira','Sábado'],diaSemana=diasDaSemana[dateObj.getDay()];document.getElementById('detailDateFormatted').textContent=`${dia}/${mes}/${ano} - ${diaSemana}`;document.getElementById('detailLucroHeader').textContent=`R$ ${totais.lucroLiquido.toFixed(2)}`;document.getElementById('detailReaisHora').textContent=`R$ ${totais.reaisPorHora.toFixed(2)}`;document.getElementById('detailReaisKm').textContent=`R$ ${totais.reaisPorKm.toFixed(2)}`;document.getElementById('detailHoras').textContent=decimalParaHorasHHMM(totais.horasTotalDecimal);document.getElementById('detailKm').textContent=totais.kmTotal.toFixed(0);document.getElementById('detailUber').textContent=`R$ ${totais.totalUber.toFixed(2)}`;document.getElementById('detail99').textContent=`R$ ${totais.total99.toFixed(2)}`;document.getElementById('detailIndrive').textContent=`R$ ${totais.totalIndrive.toFixed(2)}`;document.getElementById('detailPF').textContent=`R$ ${totais.totalPF.toFixed(2)}`;document.getElementById('detailBruto').textContent=`R$ ${totais.brutoTotal.toFixed(2)}`;document.getElementById('detailMeta').textContent=`R$ ${metaDia.toFixed(2)}`;const appsContainer=document.querySelector('.daily-detail-apps');const trofeuAnterior=appsContainer.querySelector('.daily-detail-trofeu');if(trofeuAnterior){trofeuAnterior.remove();}
if(bateuMeta){const trofeu=document.createElement('div');trofeu.className='daily-detail-trofeu';trofeu.innerHTML='<i class="fa-solid fa-trophy"></i>';appsContainer.appendChild(trofeu);if(typeof confetti==='function'){confetti({particleCount:100,spread:70,origin:{y:0.6},colors:['#fbbf24','#f59e0b','#d97706']});}}}
function hideDailyDetail(){const detailCard=document.getElementById('dailyDetailCard'),chartContainer=document.getElementById('weeklyProfitChartContainer');detailCard.classList.remove('show');chartContainer.style.display='block';}

// Funções de Backup, Restauração e Importação
function abrirModalBackup() {
    const flashOverlay = document.getElementById('flashOverlay');
    flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');
    flashOverlay.classList.add('modal-mode');
    document.getElementById('flashIcon').style.display = 'none';
    document.getElementById('flashText').style.display = 'none';
    document.getElementById('modalRegistroJornada').style.display = 'none';
    document.getElementById('modalConfiguracao').style.display = 'none';
    document.getElementById('modalConscienciaZerar').style.display = 'none';
    document.getElementById('modalMetas').style.display = 'none';
    document.getElementById('modalRelatorio').style.display = 'none';
    document.getElementById('modalDespesas').style.display = 'none';
    document.getElementById('modalPesquisaDespesas').style.display = 'none';
    document.getElementById('modalConfigDespesasVeiculo').style.display = 'none';
    document.getElementById('modalTemas').style.display = 'none';
    document.getElementById('modalBackup').style.display = 'block';
    
    // Resetar seções
    document.getElementById('restoreSection').style.display = 'none';
    document.getElementById('importSection').style.display = 'none';
    document.getElementById('selectedFile').style.display = 'none';
    document.getElementById('selectedImportFile').style.display = 'none';
    document.querySelector('.backup-progress').style.display = 'none';
    document.getElementById('importProgress').style.display = 'none';
    document.getElementById('fileInput').value = '';
    document.getElementById('importFileInput').value = '';
    backupFile = null;
    importFile = null;
    document.getElementById('btnRestaurar').disabled = true;
    document.getElementById('btnImportar').disabled = true;
    
    flashOverlay.style.display = 'flex';
    setTimeout(() => flashOverlay.classList.add('show'), 10);
}

function fecharModalBackup() {
    const flashOverlay = document.getElementById('flashOverlay');
    flashOverlay.classList.remove('show');
    setTimeout(() => {
        flashOverlay.style.display = 'none';
        document.getElementById('modalBackup').style.display = 'none';
        flashOverlay.classList.remove('modal-mode');
    }, 300);
}

function fazerBackup() {
    // Coletar todos os dados
    const backupData = {
        relatoriosDiarios: relatoriosDiarios,
        metas: carregarMetas(),
        metasDiarias: carregarMetasDiarias(),
        despesas: carregarDespesas(),
        configDespesasVeiculo: carregarConfigDespesasVeiculo(),
        tema: localStorage.getItem(TEMA_STORAGE_KEY) || 'padrao',
        dataBackup: new Date().toISOString(),
        versao: '1.0'
    };
    
    // Criar arquivo JSON
    const dataStr = JSON.stringify(backupData, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    
    // Criar link para download
    const date = new Date();
    const dateStr = `${date.getFullYear()}-${String(date.getMonth()+1).padStart(2,'0')}-${String(date.getDate()).padStart(2,'0')}`;
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `motorizze_backup_${dateStr}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
    
    mostrarFlashModerno('Backup Realizado', 'Seu backup foi criado com sucesso!');
    fecharModalBackup();
}

function iniciarRestauracao() {
    document.getElementById('restoreSection').style.display = 'block';
    document.getElementById('importSection').style.display = 'none';
    
    // Configurar input de arquivo
    const fileInput = document.getElementById('fileInput');
    fileInput.onchange = function(e) {
        if (e.target.files.length > 0) {
            backupFile = e.target.files[0];
            document.getElementById('fileName').textContent = backupFile.name;
            document.getElementById('selectedFile').style.display = 'flex';
            document.getElementById('btnRestaurar').disabled = false;
        }
    };
}

function iniciarImportacao() {
    document.getElementById('importSection').style.display = 'block';
    document.getElementById('restoreSection').style.display = 'none';
    
    // Configurar input de arquivo
    const fileInput = document.getElementById('importFileInput');
    fileInput.onchange = function(e) {
        if (e.target.files.length > 0) {
            importFile = e.target.files[0];
            document.getElementById('importFileName').textContent = importFile.name;
            document.getElementById('selectedImportFile').style.display = 'flex';
            document.getElementById('btnImportar').disabled = false;
        }
    };
}

function removerArquivo() {
    backupFile = null;
    document.getElementById('fileInput').value = '';
    document.getElementById('selectedFile').style.display = 'none';
    document.getElementById('btnRestaurar').disabled = true;
}

function removerArquivoImportacao() {
    importFile = null;
    document.getElementById('importFileInput').value = '';
    document.getElementById('selectedImportFile').style.display = 'none';
    document.getElementById('btnImportar').disabled = true;
}

function cancelarRestauracao() {
    document.getElementById('restoreSection').style.display = 'none';
    removerArquivo();
}

function cancelarImportacao() {
    document.getElementById('importSection').style.display = 'none';
    removerArquivoImportacao();
}

function restaurarBackup() {
    if (!backupFile) return;
    
    const progressBar = document.getElementById('progressFill');
    const progressText = document.getElementById('progressText');
    const progressContainer = document.querySelector('.backup-progress');
    
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.textContent = 'Lendo arquivo...';
    
    const reader = new FileReader();
    
    reader.onloadstart = function() {
        progressBar.style.width = '20%';
        progressText.textContent = 'Lendo arquivo...';
    };
    
    reader.onprogress = function(e) {
        if (e.lengthComputable) {
            const percent = (e.loaded / e.total) * 100;
            progressBar.style.width = percent + '%';
        }
    };
    
    reader.onload = function(e) {
        progressBar.style.width = '60%';
        progressText.textContent = 'Processando dados...';
        
        try {
            const backupData = JSON.parse(e.target.result);
            
            // Validar dados
            if (!backupData.relatoriosDiarios) {
                throw new Error('Arquivo de backup inválido: dados de jornadas não encontrados');
            }
            
            progressBar.style.width = '80%';
            progressText.textContent = 'Restaurando dados...';
            
            // Restaurar dados
            localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify(backupData.relatoriosDiarios || {}));
            
            if (backupData.metas) {
                localStorage.setItem(METAS_STORAGE_KEY, JSON.stringify(backupData.metas));
            }
            
            if (backupData.metasDiarias) {
                localStorage.setItem(METAS_DIARIAS_STORAGE_KEY, JSON.stringify(backupData.metasDiarias));
            }
            
            if (backupData.despesas) {
                localStorage.setItem(DESPESAS_STORAGE_KEY, JSON.stringify(backupData.despesas));
            }
            
            if (backupData.configDespesasVeiculo) {
                localStorage.setItem(CONFIG_DESPESAS_KEY, JSON.stringify(backupData.configDespesasVeiculo));
            }
            
            if (backupData.tema) {
                localStorage.setItem(TEMA_STORAGE_KEY, backupData.tema);
            }
            
            progressBar.style.width = '100%';
            progressText.textContent = 'Restauração completa!';
            
            setTimeout(() => {
                mostrarFlashModerno('Backup Restaurado', 'Todos os dados foram restaurados com sucesso!');
                fecharModalBackup();
                // Recarregar página para aplicar dados
                location.reload();
            }, 500);
            
        } catch (error) {
            progressText.textContent = 'Erro: ' + error.message;
            progressBar.style.backgroundColor = 'var(--action-red)';
            setTimeout(() => {
                mostrarFlashTemporario('<i class="fa-solid fa-triangle-exclamation" style="color:#dc2626;font-size:48px"></i>', 'Erro ao restaurar backup: ' + error.message, '254,226,226');
            }, 1000);
        }
    };
    
    reader.onerror = function() {
        progressText.textContent = 'Erro ao ler arquivo';
        progressBar.style.backgroundColor = 'var(--action-red)';
    };
    
    reader.readAsText(backupFile);
}

function importarDados() {
    if (!importFile) return;
    
    const progressBar = document.getElementById('importProgressFill');
    const progressText = document.getElementById('importProgressText');
    const progressContainer = document.getElementById('importProgress');
    
    progressContainer.style.display = 'block';
    progressBar.style.width = '0%';
    progressText.textContent = 'Lendo arquivo...';
    
    const reader = new FileReader();
    
    reader.onloadstart = function() {
        progressBar.style.width = '20%';
        progressText.textContent = 'Lendo arquivo...';
    };
    
    reader.onprogress = function(e) {
        if (e.lengthComputable) {
            const percent = (e.loaded / e.total) * 100;
            progressBar.style.width = percent + '%';
        }
    };
    
    reader.onload = function(e) {
        progressBar.style.width = '60%';
        progressText.textContent = 'Processando dados...';
        
        try {
            const importData = JSON.parse(e.target.result);
            
            progressBar.style.width = '80%';
            progressText.textContent = 'Importando dados...';
            
            let importCount = 0;
            
            // Importar dados específicos (apenas adiciona, não substitui tudo)
            if (importData.relatoriosDiarios) {
                const currentData = JSON.parse(localStorage.getItem(DATA_STORAGE_KEY) || '{}');
                // Mesclar jornadas
                Object.keys(importData.relatoriosDiarios).forEach(dateKey => {
                    if (!currentData[dateKey]) {
                        currentData[dateKey] = importData.relatoriosDiarios[dateKey];
                        importCount++;
                    } else {
                        // Adicionar trechos que não existem
                        const currentTrechos = currentData[dateKey].trechos || [];
                        const importTrechos = importData.relatoriosDiarios[dateKey].trechos || [];
                        
                        importTrechos.forEach(importTrecho => {
                            const exists = currentTrechos.some(t => 
                                t.kmInicial === importTrecho.kmInicial && 
                                t.horaInicial === importTrecho.horaInicial
                            );
                            
                            if (!exists) {
                                currentTrechos.push(importTrecho);
                                importCount++;
                            }
                        });
                        
                        currentData[dateKey].trechos = currentTrechos;
                    }
                });
                
                localStorage.setItem(DATA_STORAGE_KEY, JSON.stringify(currentData));
            }
            
            if (importData.despesas) {
                const currentDespesas = JSON.parse(localStorage.getItem(DESPESAS_STORAGE_KEY) || '{"pessoal":{},"veiculo":{}}');
                
                // Mesclar despesas pessoais
                if (importData.despesas.pessoal) {
                    Object.keys(importData.despesas.pessoal).forEach(dateKey => {
                        if (!currentDespesas.pessoal[dateKey]) {
                            currentDespesas.pessoal[dateKey] = importData.despesas.pessoal[dateKey];
                            importCount += importData.despesas.pessoal[dateKey].length;
                        } else {
                            // Adicionar despesas que não existem
                            importData.despesas.pessoal[dateKey].forEach(importDespesa => {
                                const exists = currentDespesas.pessoal[dateKey].some(d => 
                                    d.categoria === importDespesa.categoria &&
                                    d.valor === importDespesa.valor &&
                                    d.descricao === importDespesa.descricao
                                );
                                
                                if (!exists) {
                                    currentDespesas.pessoal[dateKey].push(importDespesa);
                                    importCount++;
                                }
                            });
                        }
                    });
                }
                
                // Mesclar despesas de veículo
                if (importData.despesas.veiculo) {
                    Object.keys(importData.despesas.veiculo).forEach(dateKey => {
                        if (!currentDespesas.veiculo[dateKey]) {
                            currentDespesas.veiculo[dateKey] = importData.despesas.veiculo[dateKey];
                            importCount += importData.despesas.veiculo[dateKey].length;
                        } else {
                            // Adicionar despesas que não existem
                            importData.despesas.veiculo[dateKey].forEach(importDespesa => {
                                const exists = currentDespesas.veiculo[dateKey].some(d => 
                                    d.categoria === importDespesa.categoria &&
                                    (d.valor === importDespesa.valor || d.valorTotal === importDespesa.valorTotal) &&
                                    d.descricao === importDespesa.descricao
                                );
                                
                                if (!exists) {
                                    currentDespesas.veiculo[dateKey].push(importDespesa);
                                    importCount++;
                                }
                            });
                        }
                    });
                }
                
                localStorage.setItem(DESPESAS_STORAGE_KEY, JSON.stringify(currentDespesas));
            }
            
            progressBar.style.width = '100%';
            progressText.textContent = `Importação completa! ${importCount} itens importados.`;
            
            setTimeout(() => {
                mostrarFlashModerno('Dados Importados', `${importCount} itens foram importados com sucesso!`);
                fecharModalBackup();
                // Recarregar página para aplicar dados
                location.reload();
            }, 500);
            
        } catch (error) {
            progressText.textContent = 'Erro: ' + error.message;
            progressBar.style.backgroundColor = 'var(--action-red)';
            setTimeout(() => {
                mostrarFlashTemporario('<i class="fa-solid fa-triangle-exclamation" style="color:#dc2626;font-size:48px"></i>', 'Erro ao importar dados: ' + error.message, '254,226,226');
            }, 1000);
        }
    };
    
    reader.onerror = function() {
        progressText.textContent = 'Erro ao ler arquivo';
        progressBar.style.backgroundColor = 'var(--action-red)';
    };
    
    reader.readAsText(importFile);
}

// Restante do código JavaScript permanece igual...
// ... (mantenha todas as outras funções existentes)

function abrirModalTemas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo');flashOverlay.classList.add('modal-temas');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='block';const temaAtual=localStorage.getItem(TEMA_STORAGE_KEY)||'padrao';document.querySelectorAll('.tema-option').forEach(option=>{option.classList.remove('selecionado');});const elementoAtual=document.querySelector(`.tema-${temaAtual}`);if(elementoAtual){elementoAtual.classList.add('selecionado');}
flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalTemas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalTemas').style.display='none';flashOverlay.classList.remove('modal-temas');},300);}
function selecionarTema(tema){const root=document.documentElement;switch(tema){case'padrao':root.style.setProperty('--primary','#166534');root.style.setProperty('--secondary','#22c55e');root.style.setProperty('--action-dark','#000');root.style.setProperty('--action-text','#334155');root.style.setProperty('--action-red','#ef4444');root.style.setProperty('--action-save','#22c55e');break;case'preto-amarelo':root.style.setProperty('--primary','#000000');root.style.setProperty('--secondary','#fbbf24');root.style.setProperty('--action-dark','#000000');root.style.setProperty('--action-text','#374151');root.style.setProperty('--action-red','#dc2626');root.style.setProperty('--action-save','#fbbf24');break;case'preto-vermelho':root.style.setProperty('--primary','#000000');root.style.setProperty('--secondary','#dc2626');root.style.setProperty('--action-dark','#000000');root.style.setProperty('--action-text','#374151');root.style.setProperty('--action-red','#ef4444');root.style.setProperty('--action-save','#dc2626');break;case'preto-roxo-amarelo':root.style.setProperty('--primary','#000000');root.style.setProperty('--secondary','#8b5cf6');root.style.setProperty('--action-dark','#000000');root.style.setProperty('--action-text','#374151');root.style.setProperty('--action-red','#dc2626');root.style.setProperty('--action-save','#fbbf24');break;case'terra-verde':root.style.setProperty('--primary','#364222');root.style.setProperty('--secondary','#D09128');root.style.setProperty('--action-dark','#000000');root.style.setProperty('--action-text','#374151');root.style.setProperty('--action-red','#C4552E');root.style.setProperty('--action-save','#8b5cf6');break;}
localStorage.setItem(TEMA_STORAGE_KEY,tema);document.querySelectorAll('.tema-option').forEach(option=>{option.classList.remove('selecionado');});const elementoSelecionado=document.querySelector(`.tema-${tema}`);if(elementoSelecionado){elementoSelecionado.classList.add('selecionado');}
if(weeklyChart){updateWeeklyChart();}
fecharModalTemas();mostrarFlashModerno('Tema Alterado','O tema foi alterado com sucesso!');}
function abrirModalDespesas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-despesas');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalDespesas').style.display='block';tipoDespesaSelecionado=null;tipoCombustivelSelecionado='GNV';document.getElementById('tipoPessoal').classList.remove('selecionado');document.getElementById('tipoVeiculo').classList.remove('selecionado');document.getElementById('secaoPessoal').style.display='none';document.getElementById('secaoVeiculo').style.display='none';document.getElementById('formularioPessoal').classList.remove('ativo');document.getElementById('formularioVeiculo').classList.remove('ativo');flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalDespesas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalDespesas').style.display='none';flashOverlay.classList.remove('modal-despesas');},300);}
function selecionarTipoDespesa(tipo){tipoDespesaSelecionado=tipo;document.getElementById('tipoPessoal').classList.remove('selecionado');document.getElementById('tipoVeiculo').classList.remove('selecionado');document.getElementById(`tipo${tipo.charAt(0).toUpperCase()+tipo.slice(1)}`).classList.add('selecionado');if(tipo==='pessoal'){document.getElementById('secaoPessoal').style.display='block';document.getElementById('secaoVeiculo').style.display='none';carregarDespesasPessoais();}else{document.getElementById('secaoVeiculo').style.display='block';document.getElementById('secaoPessoal').style.display='none';carregarDespesasVeiculo();}
document.getElementById('formularioPessoal').classList.remove('ativo');document.getElementById('formularioVeiculo').classList.remove('ativo');}
function mostrarFormularioDespesaPessoal(){const formulario=document.getElementById('formularioPessoal');formulario.classList.toggle('ativo');if(formulario.classList.contains('ativo')){if(!document.getElementById('despesaPessoalData').value){document.getElementById('despesaPessoalData').value=TODAY_DATE_STRING;}
if(despesaEditando===null){document.getElementById('despesaPessoalCategoria').value='';document.getElementById('despesaPessoalDescricao').value='';document.getElementById('despesaPessoalValor').value='';}}}
function mostrarFormularioDespesaVeiculo(){const formulario=document.getElementById('formularioVeiculo');formulario.classList.toggle('ativo');if(formulario.classList.contains('ativo')){if(!document.getElementById('despesaVeiculoData').value){document.getElementById('despesaVeiculoData').value=TODAY_DATE_STRING;}
if(despesaEditando===null){document.getElementById('despesaVeiculoCategoria').value='';document.querySelectorAll('.campos-especificos').forEach(campo=>{campo.classList.remove('ativo');});}}}
function mudarCategoriaVeiculo(categoria){document.querySelectorAll('.campos-especificos').forEach(campo=>{campo.classList.remove('ativo');});if(categoria==='combustivel'){document.getElementById('camposCombustivel').classList.add('ativo');selecionarCombustivel('GNV');}else if(categoria==='oleo'){document.getElementById('camposOleo').classList.add('ativo');verificarAlertaOleo();}else if(categoria==='manutencao'){document.getElementById('camposManutencao').classList.add('ativo');mudarFormaPagamentoManutencao('avista');}else{document.getElementById('camposOutrosVeiculo').classList.add('ativo');}}
function selecionarCombustivel(tipo){tipoCombustivelSelecionado=tipo;document.querySelectorAll('.combustivel-opcao').forEach(opcao=>{opcao.classList.remove('selecionado');});const opcoes=document.querySelectorAll('.combustivel-opcao');for(let opcao of opcoes){if(opcao.querySelector('.combustivel-nome').textContent===tipo){opcao.classList.add('selecionado');break;}}
document.getElementById('despesaVeiculoCombustivelTipo').value=tipo;}
function calcularCombustivel(){const precoUnitario=parseFloat(document.getElementById('despesaVeiculoCombustivelPrecoUnitario').value)||0,valorTotal=parseFloat(document.getElementById('despesaVeiculoCombustivelValorTotal').value)||0;if(precoUnitario>0&&valorTotal>0){const quantidade=valorTotal/precoUnitario;document.getElementById('despesaVeiculoCombustivelQuantidade').value=quantidade.toFixed(3);}}
function verificarAlertaOleo(){const kmAtual=parseFloat(document.getElementById('despesaVeiculoOleoKmAtual').value)||0,proximaTroca=parseFloat(document.getElementById('despesaVeiculoOleoProximaTroca').value)||0;if(kmAtual>0&&proximaTroca>0){const kmRestantes=proximaTroca-kmAtual,alertaElemento=document.getElementById('oleoAlerta');if(kmRestantes<=500){alertaElemento.classList.add('ativo');document.getElementById('kmRestantesOleo').textContent=kmRestantes.toFixed(0);if(kmRestantes<=0){alertaElemento.style.backgroundColor='#fee2e2';alertaElemento.style.color='#dc2626';alertaElemento.innerHTML='ATENÇÃO: Já passou da hora de trocar o óleo!';}else if(kmRestantes<=100){alertaElemento.style.backgroundColor='#fef3c7';alertaElemento.style.color='#d97706';alertaElemento.innerHTML=`ATENÇÃO: Faltam apenas ${kmRestantes.toFixed(0)} km para trocar o óleo!`;}else{alertaElemento.style.backgroundColor='#d1fae5';alertaElemento.style.color='#059669';alertaElemento.innerHTML=`Faltam ${kmRestantes.toFixed(0)} km para a próxima troca`;}}else{alertaElemento.classList.remove('ativo');}}}
function mudarFormaPagamentoManutencao(forma){if(forma==='cartao'){document.getElementById('camposParcelamento').classList.add('ativo');calcularParcelasManutencao();}else{document.getElementById('camposParcelamento').classList.remove('ativo');}}
function calcularParcelasManutencao(){const parcelas=parseInt(document.getElementById('despesaVeiculoManutencaoParcelas').value)||1,dataPrimeiraParcela=document.getElementById('despesaVeiculoManutencaoDataPrimeiraParcela').value,valorTotal=parseFloat(document.getElementById('despesaVeiculoManutencaoValor').value)||0;if(parcelas>0&&dataPrimeiraParcela&&valorTotal>0){const valorParcela=(valorTotal/parcelas).toFixed(2),listaParcelas=document.getElementById('listaParcelasManutencao');listaParcelas.innerHTML='';let dataParcela=new Date(dataPrimeiraParcela+'T00:00:00');for(let i=1;i<=parcelas;i++){const divParcela=document.createElement('div');divParcela.className='parcela-item';divParcela.innerHTML=`<span>Parcela ${i}:</span><span>${formatDateToDisplay(formatDateToKey(dataParcela))} - R$ ${valorParcela.replace('.',',')}</span>`;listaParcelas.appendChild(divParcela);dataParcela.setMonth(dataParcela.getMonth()+1);}}}
function carregarDespesas(){const despesasJSON=localStorage.getItem(DESPESAS_STORAGE_KEY);if(despesasJSON){const dados=JSON.parse(despesasJSON);if(Array.isArray(dados)||(dados&&!dados.pessoal&&!dados.veiculo)){despesas={pessoal:{},veiculo:{}};Object.keys(dados).forEach(data=>{const despesasDoDia=dados[data];if(Array.isArray(despesasDoDia)){despesasDoDia.forEach(despesa=>{if(despesa.tipo==='pessoal'){if(!despesas.pessoal[data])despesas.pessoal[data]=[];despesas.pessoal[data].push(despesa);}else if(despesa.tipo==='veiculo'){if(!despesas.veiculo[data])despesas.veiculo[data]=[];despesas.veiculo[data].push(despesa);}});}});salvarDespesas();}else{despesas=dados;}}else{despesas={pessoal:{},veiculo:{}};}
return despesas;}
function salvarDespesas(){localStorage.setItem(DESPESAS_STORAGE_KEY,JSON.stringify(despesas));}
function carregarConfigDespesasVeiculo(){const configJSON=localStorage.getItem(CONFIG_DESPESAS_KEY);configDespesasVeiculo=configJSON?JSON.parse(configJSON):{combustivel:false,oleo:false,manutencao:false,lavagem:false,outros:false};return configDespesasVeiculo;}
function salvarConfigDespesasVeiculoNoStorage(){localStorage.setItem(CONFIG_DESPESAS_KEY,JSON.stringify(configDespesasVeiculo));}
function despesaDeveSerIncluidaNoCalculo(despesa){if(despesa.tipo==='pessoal'){return true;}
if(despesa.tipo==='veiculo'){const config=carregarConfigDespesasVeiculo();switch(despesa.categoria){case'combustivel':return config.combustivel;case'oleo':return config.oleo;case'manutencao':return config.manutencao;case'lavagem':return config.lavagem;case'outros':return config.outros;default:return false;}}
return false;}
function salvarDespesaPessoal(){const data=document.getElementById('despesaPessoalData').value,categoria=document.getElementById('despesaPessoalCategoria').value,descricao=document.getElementById('despesaPessoalDescricao').value,valor=parseFloat(document.getElementById('despesaPessoalValor').value);if(!data){alert('Informe a data');return;}
if(!categoria){alert('Selecione a categoria');return;}
if(!valor||valor<=0){alert('Informe um valor válido');return;}
carregarDespesas();if(!despesas.pessoal[data]){despesas.pessoal[data]=[];}
const novaDespesa={tipo:'pessoal',categoria,descricao,valor,data};if(despesaEditando!==null&&despesaEditando.tipo==='pessoal'){despesas.pessoal[data][despesaEditando.index]=novaDespesa;}else{despesas.pessoal[data].push(novaDespesa);}
salvarDespesas();mostrarFormularioDespesaPessoal();carregarDespesasPessoais();mostrarFlashModerno('Sucesso!','Despesa pessoal salva com sucesso!');despesaEditando=null;}
function salvarDespesaVeiculo(){const data=document.getElementById('despesaVeiculoData').value,categoria=document.getElementById('despesaVeiculoCategoria').value;if(!data){alert('Informe a data');return;}
if(!categoria){alert('Selecione a categoria');return;}
let despesaVeiculo;if(categoria==='combustivel'){const tipoCombustivel=document.getElementById('despesaVeiculoCombustivelTipo').value||tipoCombustivelSelecionado,precoUnitario=parseFloat(document.getElementById('despesaVeiculoCombustivelPrecoUnitario').value),valorTotal=parseFloat(document.getElementById('despesaVeiculoCombustivelValorTotal').value);if(!tipoCombustivel||!precoUnitario||!valorTotal){alert('Preencha todos os campos do combustível');return;}
const quantidade=valorTotal/precoUnitario;const odometroInicial=parseFloat(document.getElementById('despesaVeiculoCombustivelOdometroInicial').value)||null;const odometroFinal=parseFloat(document.getElementById('despesaVeiculoCombustivelOdometroFinal').value)||null;let kmRodados=null;if(odometroInicial!==null&&odometroFinal!==null&&odometroFinal>odometroInicial){kmRodados=odometroFinal-odometroInicial;}
despesaVeiculo={tipo:'veiculo',categoria:'combustivel',subcategoria:tipoCombustivel,quantidade,precoUnitario,valorTotal,odometroInicial,odometroFinal,kmRodados,data};}else if(categoria==='oleo'){const kmAtual=parseFloat(document.getElementById('despesaVeiculoOleoKmAtual').value),proximaTroca=parseFloat(document.getElementById('despesaVeiculoOleoProximaTroca').value),valor=parseFloat(document.getElementById('despesaVeiculoOleoValor').value);if(!kmAtual||!proximaTroca||!valor){alert('Preencha todos os campos do óleo');return;}
despesaVeiculo={tipo:'veiculo',categoria:'oleo',kmAtual,proximaTroca,valor,data};}else if(categoria==='manutencao'){const descricao=document.getElementById('despesaVeiculoManutencaoDescricao').value,formaPagamento=document.getElementById('despesaVeiculoManutencaoPagamento').value,valor=parseFloat(document.getElementById('despesaVeiculoManutencaoValor').value);if(!descricao||!valor){alert('Preencha a descrição e o valor da manutenção');return;}
despesaVeiculo={tipo:'veiculo',categoria:'manutencao',descricao,formaPagamento,valor,data};if(formaPagamento==='cartao'){const parcelas=parseInt(document.getElementById('despesaVeiculoManutencaoParcelas').value)||1,dataPrimeiraParcela=document.getElementById('despesaVeiculoManutencaoDataPrimeiraParcela').value;if(!dataPrimeiraParcela){alert('Informe a data da primeira parcela');return;}
despesaVeiculo.parcelas=parcelas;despesaVeiculo.dataPrimeiraParcela=dataPrimeiraParcela;const datasParcelas=[];let dataParcela=new Date(dataPrimeiraParcela+'T00:00:00');for(let i=0;i<parcelas;i++){datasParcelas.push(formatDateToKey(dataParcela));dataParcela.setMonth(dataParcela.getMonth()+1);}
despesaVeiculo.datasParcelas=datasParcelas;despesaVeiculo.valorParcela=(valor/parcelas).toFixed(2);}}else{const descricao=document.getElementById('despesaVeiculoOutrosDescricao').value,valor=parseFloat(document.getElementById('despesaVeiculoOutrosValor').value);if(!valor){alert('Informe o valor');return;}
despesaVeiculo={tipo:'veiculo',categoria:categoria,descricao,valor,data};}
carregarDespesas();if(!despesas.veiculo[data]){despesas.veiculo[data]=[];}
if(despesaEditando!==null&&despesaEditando.tipo==='veiculo'){despesas.veiculo[data][despesaEditando.index]=despesaVeiculo;}else{despesas.veiculo[data].push(despesaVeiculo);}
salvarDespesas();mostrarFormularioDespesaVeiculo();carregarDespesasVeiculo();mostrarFlashModerno('Sucesso!','Despesa do veículo salva com sucesso!');despesaEditando=null;}
function carregarDespesasPessoais(){carregarDespesas();const lista=document.getElementById('listaDespesasPessoal'),totalElement=document.getElementById('totalDespesasPessoal');let todasDespesasPessoais=[],total=0;Object.keys(despesas.pessoal).forEach(data=>{despesas.pessoal[data].forEach((despesa,index)=>{todasDespesasPessoais.push({...despesa,data,index});total+=despesa.valor;});});totalElement.textContent=`R$ ${total.toFixed(2).replace('.',',')}`;lista.innerHTML='';if(todasDespesasPessoais.length===0){lista.innerHTML=`<div class="despesa-empty"><i class="fa-solid fa-receipt"></i><p>Nenhuma despesa pessoal registrada</p></div>`;return;}
todasDespesasPessoais.sort((a,b)=>new Date(b.data)-new Date(a.data));todasDespesasPessoais.forEach((despesaInfo)=>{const{data,index,...despesa}=despesaInfo;const despesaItem=document.createElement('div');despesaItem.className='despesa-item';despesaItem.dataset.data=data;despesaItem.dataset.index=index;const icone=obterIconeDespesa(despesa.categoria),categoriaFormatada=formatarCategoriaDespesa(despesa.categoria);despesaItem.innerHTML=`<div class="despesa-icon"><i class="${icone}"></i></div><div class="despesa-info"><div class="despesa-tipo">${categoriaFormatada}</div><div class="despesa-descricao">${despesa.descricao||''}</div><div class="despesa-detalhes">${formatDateToDisplay(data)}</div></div><div class="despesa-valor">R$ ${despesa.valor.toFixed(2).replace('.',',')}</div><div class="despesa-actions"><button class="despesa-btn edit" onclick="editarDespesaPessoal('${data}',${index})"><i class="fa-solid fa-pen"></i></button><button class="despesa-btn delete" onclick="excluirDespesa('pessoal','${data}',${index})"><i class="fa-solid fa-trash-can"></i></button></div>`;lista.appendChild(despesaItem);});}
function carregarDespesasVeiculo(){carregarDespesas();const lista=document.getElementById('listaDespesasVeiculo'),totalElement=document.getElementById('totalDespesasVeiculo');let todasDespesasVeiculo=[],total=0;Object.keys(despesas.veiculo).forEach(data=>{despesas.veiculo[data].forEach((despesa,index)=>{todasDespesasVeiculo.push({...despesa,data,index});total+=despesa.valor||despesa.valorTotal||0;});});totalElement.textContent=`R$ ${total.toFixed(2).replace('.',',')}`;lista.innerHTML='';if(todasDespesasVeiculo.length===0){lista.innerHTML=`<div class="despesa-empty"><i class="fa-solid fa-car"></i><p>Nenhuma despesa do veículo registrada</p></div>`;return;}
todasDespesasVeiculo.sort((a,b)=>new Date(b.data)-new Date(a.data));todasDespesasVeiculo.forEach((despesaInfo)=>{const{data,index,...despesa}=despesaInfo;const despesaItem=document.createElement('div');despesaItem.className='despesa-item';despesaItem.dataset.data=data;despesaItem.dataset.index=index;const icone=obterIconeDespesa(despesa.categoria),categoriaFormatada=formatarCategoriaDespesa(despesa.categoria);let detalhes='';if(despesa.categoria==='combustivel'){detalhes=`${despesa.subcategoria} - ${despesa.quantidade.toFixed(3)} ${despesa.subcategoria==='GNV'?'m³':'litros'}`;if(despesa.kmRodados){detalhes+=` (${despesa.kmRodados.toFixed(0)} km rodados)`;}}else if(despesa.categoria==='oleo'){const kmRodadosHoje=dadosDoDiaExibido?.trechos?.reduce((total,trecho)=>{return total+(trecho.publicado?(trecho.kmFinal-trecho.kmInicial):0);},0)||0;const kmRestantes=despesa.proximaTroca-(despesa.kmAtual+kmRodadosHoje);detalhes=`Troca: ${despesa.kmAtual} km | Próxima: ${despesa.proximaTroca} km`;if(kmRestantes<=500){despesaItem.style.borderLeft='4px solid var(--action-red)';despesaItem.title=`Faltam apenas ${kmRestantes.toFixed(0)} km para a próxima troca de óleo!`;}}else if(despesa.categoria==='manutencao'){detalhes=despesa.descricao;if(despesa.formaPagamento==='cartao'){detalhes+=` (${despesa.parcelas}x de R$ ${despesa.valorParcela})`;}}else{detalhes=despesa.descricao||'';}
despesaItem.innerHTML=`<div class="despesa-icon"><i class="${icone}"></i></div><div class="despesa-info"><div class="despesa-tipo">${categoriaFormatada}</div><div class="despesa-descricao">${detalhes}</div><div class="despesa-detalhes">${formatDateToDisplay(data)}</div></div><div class="despesa-valor">R$ ${(despesa.valor||despesa.valorTotal).toFixed(2).replace('.',',')}</div><div class="despesa-actions"><button class="despesa-btn edit" onclick="editarDespesaVeiculo('${data}',${index})"><i class="fa-solid fa-pen"></i></button><button class="despesa-btn delete" onclick="excluirDespesa('veiculo','${data}',${index})"><i class="fa-solid fa-trash-can"></i></button></div>`;lista.appendChild(despesaItem);});}
function obterIconeDespesa(categoria){switch(categoria){case'comida':return'fa-solid fa-utensils';case'bebida':return'fa-solid fa-wine-glass';case'internet':return'fa-solid fa-wifi';case'combustivel':return'fa-solid fa-gas-pump';case'oleo':return'fa-solid fa-oil-can';case'manutencao':return'fa-solid fa-screwdriver-wrench';case'lavagem':return'fa-solid fa-soap';case'outros':return'fa-solid fa-receipt';default:return'fa-solid fa-receipt';}}
function formatarCategoriaDespesa(categoria){switch(categoria){case'comida':return'Comida';case'bebida':return'Bebida';case'internet':return'Internet';case'combustivel':return'Combustível';case'oleo':return'Óleo';case'manutencao':return'Manutenção';case'lavagem':return'Lavagem';case'outros':return'Outros';default:return categoria;}}
function editarDespesaPessoal(data,index){const despesa=despesas.pessoal[data][index];document.getElementById('despesaPessoalData').value=despesa.data;document.getElementById('despesaPessoalCategoria').value=despesa.categoria;document.getElementById('despesaPessoalDescricao').value=despesa.descricao||'';document.getElementById('despesaPessoalValor').value=despesa.valor;document.getElementById('formularioPessoal').classList.add('ativo');despesaEditando={tipo:'pessoal',data,index};}
function editarDespesaVeiculo(data,index){const despesa=despesas.veiculo[data][index];document.getElementById('despesaVeiculoData').value=despesa.data;document.getElementById('despesaVeiculoCategoria').value=despesa.categoria;document.getElementById('formularioVeiculo').classList.add('ativo');mudarCategoriaVeiculo(despesa.categoria);if(despesa.categoria==='combustivel'){selecionarCombustivel(despesa.subcategoria);document.getElementById('despesaVeiculoCombustivelPrecoUnitario').value=despesa.precoUnitario;document.getElementById('despesaVeiculoCombustivelValorTotal').value=despesa.valorTotal;document.getElementById('despesaVeiculoCombustivelOdometroInicial').value=despesa.odometroInicial||'';document.getElementById('despesaVeiculoCombustivelOdometroFinal').value=despesa.odometroFinal||'';calcularCombustivel();}else if(despesa.categoria==='oleo'){document.getElementById('despesaVeiculoOleoKmAtual').value=despesa.kmAtual;document.getElementById('despesaVeiculoOleoProximaTroca').value=despesa.proximaTroca;document.getElementById('despesaVeiculoOleoValor').value=despesa.valor;verificarAlertaOleo();}else if(despesa.categoria==='manutencao'){document.getElementById('despesaVeiculoManutencaoDescricao').value=despesa.descricao;document.getElementById('despesaVeiculoManutencaoPagamento').value=despesa.formaPagamento;document.getElementById('despesaVeiculoManutencaoValor').value=despesa.valor;if(despesa.formaPagamento==='cartao'){document.getElementById('despesaVeiculoManutencaoParcelas').value=despesa.parcelas;document.getElementById('despesaVeiculoManutencaoDataPrimeiraParcela').value=despesa.dataPrimeiraParcela;mudarFormaPagamentoManutencao('cartao');}}else{document.getElementById('despesaVeiculoOutrosDescricao').value=despesa.descricao||'';document.getElementById('despesaVeiculoOutrosValor').value=despesa.valor;}
despesaEditando={tipo:'veiculo',data,index};}
function excluirDespesa(tipo,data,index){if(!confirm('Tem certeza que deseja excluir esta despesa?')){return;}
carregarDespesas();if(tipo==='pessoal'&&despesas.pessoal[data]){despesas.pessoal[data].splice(index,1);if(despesas.pessoal[data].length===0){delete despesas.pessoal[data];}}else if(tipo==='veiculo'&&despesas.veiculo[data]){despesas.veiculo[data].splice(index,1);if(despesas.veiculo[data].length===0){delete despesas.veiculo[data];}}
salvarDespesas();if(tipoDespesaSelecionado==='pessoal'){carregarDespesasPessoais();}else{carregarDespesasVeiculo();}
mostrarFlashModerno('Excluído!','Despesa excluída com sucesso!');}
function cancelarDespesaPessoal(){document.getElementById('formularioPessoal').classList.remove('ativo');despesaEditando=null;}
function cancelarDespesaVeiculo(){document.getElementById('formularioVeiculo').classList.remove('ativo');despesaEditando=null;}
function abrirModalPesquisaDespesas(tipo){pesquisaTipoAtual=tipo;categoriasSelecionadasPesquisa=[];ordemPesquisa='recente';const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-pesquisa-despesas');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='block';const dataFim=new Date(),dataInicio=new Date();dataInicio.setDate(dataInicio.getDate()-30);document.getElementById('pesquisaDataInicio').value=formatDateToKey(dataInicio);document.getElementById('pesquisaDataFim').value=formatDateToKey(dataFim);document.getElementById('pesquisaResultados').innerHTML=`<div class="despesa-empty"><i class="fa-solid fa-search"></i><p>Nenhuma despesa encontrada. Aplique os filtros e clique em Pesquisar.</p></div>`;document.querySelector('.pesquisa-total').style.display='none';const categoriasContainer=document.getElementById('categoriasTipo');categoriasContainer.innerHTML='';const categorias=tipo==='pessoal'?['comida','bebida','internet','outros']:['combustivel','oleo','manutencao','lavagem','outros'];const todasCheckbox=document.createElement('div');todasCheckbox.className='categoria-checkbox selecionada';todasCheckbox.innerHTML='<span>Todas</span>';todasCheckbox.onclick=()=>toggleCategoriaPesquisa(todasCheckbox,'todos');categoriasContainer.appendChild(todasCheckbox);categoriasSelecionadasPesquisa.push('todos');categorias.forEach(categoria=>{const checkbox=document.createElement('div');checkbox.className='categoria-checkbox';checkbox.innerHTML=`<span>${formatarCategoriaDespesa(categoria)}</span>`;checkbox.onclick=()=>toggleCategoriaPesquisa(checkbox,categoria);categoriasContainer.appendChild(checkbox);});document.querySelectorAll('.ordem-option').forEach(option=>{option.classList.remove('selecionada');});document.querySelector('.ordem-option:first-child').classList.add('selecionada');flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalPesquisaDespesas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';flashOverlay.classList.remove('modal-pesquisa-despesas');},300);}
function toggleCategoriaPesquisa(elemento,categoria){if(categoria==='todos'){if(elemento.classList.contains('selecionada')){elemento.classList.remove('selecionada');categoriasSelecionadasPesquisa=categoriasSelecionadasPesquisa.filter(c=>c!=='todos');const categorias=pesquisaTipoAtual==='pessoal'?['comida','bebida','internet','outros']:['combustivel','oleo','manutencao','lavagem','outros'];categorias.forEach(cat=>{if(!categoriasSelecionadasPesquisa.includes(cat)){categoriasSelecionadasPesquisa.push(cat);}});document.querySelectorAll('.categoria-checkbox').forEach(cb=>{if(!cb.querySelector('span').textContent.includes('Todas')){cb.classList.add('selecionada');}});}else{elemento.classList.add('selecionada');categoriasSelecionadasPesquisa=['todos'];document.querySelectorAll('.categoria-checkbox').forEach(cb=>{if(!cb.querySelector('span').textContent.includes('Todas')){cb.classList.remove('selecionada');}});}}else{if(elemento.classList.contains('selecionada')){elemento.classList.remove('selecionada');categoriasSelecionadasPesquisa=categoriasSelecionadasPesquisa.filter(c=>c!==categoria);const todosIndex=categoriasSelecionadasPesquisa.indexOf('todos');if(todosIndex!==-1){categoriasSelecionadasPesquisa.splice(todosIndex,1);document.querySelector('.categoria-checkbox:first-child').classList.remove('selecionada');}}else{elemento.classList.add('selecionada');categoriasSelecionadasPesquisa.push(categoria);}
const categorias=pesquisaTipoAtual==='pessoal'?['comida','bebida','internet','outros']:['combustivel','oleo','manutencao','lavagem','outros'];const todasCategoriasSelecionadas=categorias.every(cat=>categoriasSelecionadasPesquisa.includes(cat));if(todasCategoriasSelecionadas&&!categoriasSelecionadasPesquisa.includes('todos')){categoriasSelecionadasPesquisa.push('todos');document.querySelector('.categoria-checkbox:first-child').classList.add('selecionada');}}}
function selecionarOrdemPesquisa(elemento,ordem){ordemPesquisa=ordem;document.querySelectorAll('.ordem-option').forEach(option=>{option.classList.remove('selecionada');});elemento.classList.add('selecionada');}
function realizarPesquisaDespesas(){const dataInicio=document.getElementById('pesquisaDataInicio').value,dataFim=document.getElementById('pesquisaDataFim').value;if(!dataInicio||!dataFim){alert('Selecione as datas de início e fim');return;}
if(new Date(dataInicio)>new Date(dataFim)){alert('A data de início deve ser anterior à data de fim');return;}
carregarDespesas();let resultados=[],total=0;const despesasTipo=pesquisaTipoAtual==='pessoal'?despesas.pessoal:despesas.veiculo;Object.keys(despesasTipo).forEach(data=>{if(data>=dataInicio&&data<=dataFim){despesasTipo[data].forEach(despesa=>{if(categoriasSelecionadasPesquisa.includes('todos')||categoriasSelecionadasPesquisa.includes(despesa.categoria)){resultados.push({...despesa,data});total+=despesa.valor||despesa.valorTotal||0;}});}});if(ordemPesquisa==='recente'){resultados.sort((a,b)=>new Date(b.data)-new Date(a.data));}else{resultados.sort((a,b)=>new Date(a.data)-new Date(b.data));}
const resultadosContainer=document.getElementById('pesquisaResultados');resultadosContainer.innerHTML='';if(resultados.length===0){resultadosContainer.innerHTML=`<div class="despesa-empty"><i class="fa-solid fa-search"></i><p>Nenhuma despesa encontrada com os filtros aplicados.</p></div>`;document.querySelector('.pesquisa-total').style.display='none';return;}
resultados.forEach((despesa)=>{const despesaItem=document.createElement('div');despesaItem.className='despesa-item';const icone=obterIconeDespesa(despesa.categoria),categoriaFormatada=formatarCategoriaDespesa(despesa.categoria);let detalhes='';if(despesa.categoria==='combustivel'){detalhes=`${despesa.subcategoria} - ${despesa.quantidade.toFixed(3)} ${despesa.subcategoria==='GNV'?'m³':'litros'}`;}else if(despesa.categoria==='oleo'){detalhes=`Troca: ${despesa.kmAtual} km | Próxima: ${despesa.proximaTroca} km`;}else if(despesa.categoria==='manutencao'){detalhes=despesa.descricao;}else{detalhes=despesa.descricao||'';}
despesaItem.innerHTML=`<div class="despesa-icon"><i class="${icone}"></i></div><div class="despesa-info"><div class="despesa-tipo">${categoriaFormatada}</div><div class="despesa-descricao">${detalhes}</div><div class="despesa-detalhes">${formatDateToDisplay(despesa.data)}</div></div><div class="despesa-valor">R$ ${(despesa.valor||despesa.valorTotal).toFixed(2).replace('.',',')}</div>`;resultadosContainer.appendChild(despesaItem);});document.getElementById('pesquisaTotalValor').textContent=`R$ ${total.toFixed(2).replace('.',',')}`;document.querySelector('.pesquisa-total').style.display='flex';}
function limparPesquisaDespesas(){document.getElementById('pesquisaDataInicio').value='';document.getElementById('pesquisaDataFim').value='';categoriasSelecionadasPesquisa=['todos'];document.querySelectorAll('.categoria-checkbox').forEach((cb,index)=>{if(index===0){cb.classList.add('selecionada');}else{cb.classList.remove('selecionada');}});document.querySelectorAll('.ordem-option').forEach((option,index)=>{if(index===0){option.classList.add('selecionada');}else{option.classList.remove('selecionada');}});ordemPesquisa='recente';document.getElementById('pesquisaResultados').innerHTML=`<div class="despesa-empty"><i class="fa-solid fa-search"></i><p>Nenhuma despesa encontrada. Aplique os filtros e clique em Pesquisar.</p></div>`;document.querySelector('.pesquisa-total').style.display='none';}
function abrirModalConfigDespesasVeiculo(){carregarConfigDespesasVeiculo();const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-temas');flashOverlay.classList.add('modal-config-despesas-veiculo');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='block';document.getElementById('configCombustivel').checked=configDespesasVeiculo.combustivel;document.getElementById('configOleo').checked=configDespesasVeiculo.oleo;document.getElementById('configManutencao').checked=configDespesasVeiculo.manutencao;document.getElementById('configLavagem').checked=configDespesasVeiculo.lavagem;document.getElementById('configOutrosVeiculo').checked=configDespesasVeiculo.outros;flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalConfigDespesasVeiculo(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';flashOverlay.classList.remove('modal-config-despesas-veiculo');},300);}
function salvarConfigDespesasVeiculo(){configDespesasVeiculo={combustivel:document.getElementById('configCombustivel').checked,oleo:document.getElementById('configOleo').checked,manutencao:document.getElementById('configManutencao').checked,lavagem:document.getElementById('configLavagem').checked,outros:document.getElementById('configOutrosVeiculo').checked};salvarConfigDespesasVeiculoNoStorage();mostrarFlashModerno('Configurações Salvas','Configurações de despesas salvas com sucesso!');fecharModalConfigDespesasVeiculo();abrirModalDespesas();}
function calcularTotaisDoDia(dailyData){if(!dailyData)return{kmTotal:0,horasTotalDecimal:0,brutoTotal:0,lucroLiquido:0,totalUber:0,total99:0,totalIndrive:0,totalPF:0,reaisPorKm:0,reaisPorHora:0,gastoGNV:0,totalDespesas:0};let kmTotal=0,horasTotalDecimal=0,brutoTotal=0,lucroLiquido=0,totalUber=0,total99=0,totalIndrive=0,totalPF=0;dailyData.trechos.forEach((trecho)=>{if(trecho.publicado){totalUber+=trecho.uber||0;total99+=trecho.n99||0;totalIndrive+=trecho.indrive||0;totalPF+=trecho.pf||0;const kmRodado=trecho.kmFinal-trecho.kmInicial;const horasRodadas=calcularDiferencaHoras(trecho.horaInicial,trecho.horaFinal);kmTotal+=kmRodado;horasTotalDecimal+=horasRodadas;}});brutoTotal=totalUber+total99+totalIndrive+totalPF;let reaisPorKm=0;if(kmTotal>0){reaisPorKm=brutoTotal/kmTotal;}
let reaisPorHora=0;if(horasTotalDecimal>0){reaisPorHora=brutoTotal/horasTotalDecimal;}
const precoGNV=dailyData.precoGNV||4.79;const mediaGNV=dailyData.mediaGNV||18.00;let gastoGNV=0;if(mediaGNV>0&&precoGNV>0){const litrosGNV=kmTotal/mediaGNV;gastoGNV=litrosGNV*precoGNV;}
let totalDespesas=0;const despesasPessoaisDoDia=despesas.pessoal[dailyData.date]||[];despesasPessoaisDoDia.forEach(despesa=>{totalDespesas+=despesa.valor||0;});const despesasVeiculoDoDia=despesas.veiculo[dailyData.date]||[];const combustivelRegistrado=despesasVeiculoDoDia.find(d=>d.categoria==='combustivel'&&despesaDeveSerIncluidaNoCalculo(d));if(combustivelRegistrado){totalDespesas+=combustivelRegistrado.valorTotal||combustivelRegistrado.valor||0;}else{totalDespesas+=gastoGNV;}
despesasVeiculoDoDia.forEach(despesa=>{if(despesaDeveSerIncluidaNoCalculo(despesa)){if(despesa.categoria==='combustivel'){return;}
totalDespesas+=despesa.valor||despesa.valorTotal||0;}});lucroLiquido=brutoTotal-totalDespesas;return{kmTotal,horasTotalDecimal,brutoTotal,lucroLiquido,totalUber,total99,totalIndrive,totalPF,reaisPorKm,reaisPorHora,gastoGNV,totalDespesas};}
function abrirModalMetas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-metas');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalMetas').style.display='block';carregarMetas();const dias=['segunda','terca','quarta','quinta','sexta','sabado','domingo'];dias.forEach(dia=>{const input=document.getElementById(`meta-${dia}`);if(input){input.value=metas[dia]||'250.00';}});const toggleEdit=document.getElementById('toggleEditMetas');if(toggleEdit){toggleEdit.checked=false;const inputs=document.querySelectorAll('#modalMetas input[type="number"]');inputs.forEach(input=>{input.disabled=true;});toggleEdit.addEventListener('change',function(){const inputs=document.querySelectorAll('#modalMetas input[type="number"]');inputs.forEach(input=>{input.disabled=!this.checked;});});}
flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalMetas(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalMetas').style.display='none';flashOverlay.classList.remove('modal-metas');},300);}
function salvarTodasMetas(){const dias=['segunda','terca','quarta','quinta','sexta','sabado','domingo'];let todasValidas=true;dias.forEach(dia=>{const input=document.getElementById(`meta-${dia}`),valor=parseFloat(input.value);if(input.value&&(isNaN(valor)||valor<0)){todasValidas=false;input.style.borderColor='var(--action-red)';}else{input.style.borderColor='';if(input.value){metas[dia]=valor;}else{delete metas[dia];}}});if(!todasValidas){alert("Algumas metas contêm valores inválidos. Corrija e tente novamente.");return;}
salvarMetas();fecharModalMetas();mostrarFlashModerno('Salvo!','Metas salvas com sucesso!');}
function limparTodasMetas(){if(confirm("Tem certeza que deseja limpar todas as metas?")){const dias=['segunda','terca','quarta','quinta','sexta','sabado','domingo'];dias.forEach(dia=>{const input=document.getElementById(`meta-${dia}`);input.value='';delete metas[dia];});salvarMetas();mostrarFlashModerno('Limpo!','Todas as metas foram limpas!');}}
function abrirModalConscienciaZerar(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-consciencia-zerar');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalConscienciaZerar').style.display='block';flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalConscienciaZerar(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';flashOverlay.classList.remove('modal-consciencia-zerar');},300);}
function confirmarZerarTudo(){fecharModalConscienciaZerar();const precoGNV=dadosDoDiaExibido.precoGNV||4.79,mediaGNV=dadosDoDiaExibido.mediaGNV||18.00;localStorage.removeItem(DATA_STORAGE_KEY);localStorage.removeItem(METAS_DIARIAS_STORAGE_KEY);localStorage.removeItem(DESPESAS_STORAGE_KEY);localStorage.removeItem(CONFIG_DESPESAS_KEY);localStorage.removeItem(TEMA_STORAGE_KEY);relatoriosDiarios={};despesas={pessoal:{},veiculo:{}};configDespesasVeiculo={};dadosDoDiaExibido=ensureDailyDataStructure(getTodayDate(),true);dadosDoDiaExibido.precoGNV=precoGNV;dadosDoDiaExibido.mediaGNV=mediaGNV;relatoriosDiarios[dadosDoDiaExibido.date]=dadosDoDiaExibido;salvarDados();salvarDespesas();salvarConfigDespesasVeiculoNoStorage();mostrarFlashModerno('Aplicativo Zerado','Todos os dados foram resetados!');}
function abrirModalConfiguracaoGNV(source){configGNVSource=source||'menu';const flashOverlay=document.getElementById('flashOverlay');document.getElementById('configPrecoGNV').value=dadosDoDiaExibido.precoGNV||'4.79';document.getElementById('configMediaGNV').value=dadosDoDiaExibido.mediaGNV||'18.00';flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-consciencia-zerar','modal-metas','modal-relatorio','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-config-gnv');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalRelatorio').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalConfiguracao').style.display='block';flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalConfiguracao(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalConfiguracao').style.display='none';flashOverlay.classList.remove('modal-config-gnv');if(configGNVSource==='despesas'){abrirModalDespesas();}},300);}
function salvarConfiguracaoGNV(){const preco=parseFloat(document.getElementById('configPrecoGNV').value),media=parseFloat(document.getElementById('configMediaGNV').value),mediaInput=document.getElementById('configMediaGNV');if(mediaInput.value.length>5){alert("O consumo GNV deve ter no máximo 5 caracteres.");return;}
if(isNaN(preco)||preco<=0||isNaN(media)||media<=0){alert("Preço e Consumo GNV devem ser números válidos e positivos.");return;}
Object.keys(relatoriosDiarios).forEach(dateKey=>{relatoriosDiarios[dateKey].precoGNV=preco;relatoriosDiarios[dateKey].mediaGNV=media;});dadosDoDiaExibido.precoGNV=preco;dadosDoDiaExibido.mediaGNV=media;salvarDados();atualizarUI();fecharModalConfiguracao();mostrarFlashModerno('Configurações Salvas','Parâmetros GNV atualizados!');}
function abrirModalRegistro(index) {
    const flashOverlay = document.getElementById('flashOverlay');
    flashOverlay.classList.remove('show');
    setTimeout(() => {
        document.getElementById('originalExibitionDay').value = diaExibido;
        const isEditing = index !== -1;
        let jornada = isEditing ? dadosDoDiaExibido.trechos[index] : null;
        document.getElementById('trechoIndexToEdit').value = index;
        document.getElementById('dataJornada').value = diaExibido;
        document.getElementById('kmInicialTrecho').value = '';
        document.getElementById('horaInicialTrecho').value = '';
        document.getElementById('kmFinalTrecho').value = '';
        document.getElementById('horaFinalTrecho').value = '';
        document.getElementById('ganhoUber').value = '0.00';
        document.getElementById('ganho99').value = '0.00';
        document.getElementById('ganhoIndrive').value = '0.00';
        document.getElementById('ganhoPF').value = '0.00';
        const now = new Date();
        const currentTime = now.toTimeString().slice(0,5);
        document.getElementById('horaInicialTrecho').value = currentTime;
        const btnPublicar = document.getElementById('btnPublicarJornada');
        const btnSalvarRascunho = document.getElementById('btnSalvarRascunho');
        const tituloModal = document.querySelector('.modal-jornada-header-title');
        
        if (index === -1) {
            // Modo inserção
            document.getElementById('camposExtras').classList.add('hidden-field');
            document.getElementById('camposGanhos').classList.add('hidden-field');
            btnPublicar.classList.add('hidden-field');
            btnSalvarRascunho.textContent = 'INICIAR';
            flashOverlay.classList.remove('modal-edicao');
            tituloModal.textContent = 'INSERIR JORNADA';
            btnPublicar.textContent = 'ENCERRAR';
        } else {
            // Modo edição
            document.getElementById('camposExtras').classList.remove('hidden-field');
            document.getElementById('camposGanhos').classList.remove('hidden-field');
            btnPublicar.classList.remove('hidden-field');
            btnSalvarRascunho.textContent = 'GUARDAR';
            flashOverlay.classList.add('modal-edicao');
            tituloModal.textContent = 'EDITAR JORNADA';
            btnPublicar.textContent = 'ENCERRAR';
        }

        if (jornada) {
            document.getElementById('dataJornada').value = diaExibido;
            document.getElementById('kmInicialTrecho').value = jornada.kmInicial || '';
            document.getElementById('horaInicialTrecho').value = jornada.horaInicial || '';
            document.getElementById('kmFinalTrecho').value = jornada.kmFinal || '';
            document.getElementById('horaFinalTrecho').value = jornada.horaFinal || '';
            document.getElementById('ganhoUber').value = (jornada.uber || 0).toFixed(2);
            document.getElementById('ganho99').value = (jornada.n99 || 0).toFixed(2);
            document.getElementById('ganhoIndrive').value = (jornada.indrive || 0).toFixed(2);
            document.getElementById('ganhoPF').value = (jornada.pf || 0).toFixed(2);
        }

        flashOverlay.classList.remove('flash-mode', 'modal-mode', 'modal-config-gnv', 'modal-consciencia-zerar', 'modal-metas', 'modal-relatorio', 'modal-despesas', 'modal-pesquisa-despesas', 'modal-config-despesas-veiculo', 'modal-temas');
        flashOverlay.classList.add('modal-jornada');
        document.getElementById('flashIcon').style.display = 'none';
        document.getElementById('flashText').style.display = 'none';
        document.getElementById('modalConfiguracao').style.display = 'none';
        document.getElementById('modalConscienciaZerar').style.display = 'none';
        document.getElementById('modalMetas').style.display = 'none';
        document.getElementById('modalRelatorio').style.display = 'none';
        document.getElementById('modalDespesas').style.display = 'none';
        document.getElementById('modalPesquisaDespesas').style.display = 'none';
        document.getElementById('modalConfigDespesasVeiculo').style.display = 'none';
        document.getElementById('modalTemas').style.display = 'none';
        document.getElementById('modalRegistroJornada').style.display = 'block';
        flashOverlay.style.display = 'flex';
        setTimeout(() => {
            flashOverlay.classList.add('show');
        }, 50);
    }, 10);
}
function fecharModalRegistro(){const flashOverlay=document.getElementById('flashOverlay'),originalDay=document.getElementById('originalExibitionDay').value;flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalRegistroJornada').style.display='none';flashOverlay.classList.remove('modal-jornada','modal-edicao');document.getElementById('trechoIndexToEdit').value='-1';document.getElementById('originalExibitionDay').value='';document.getElementById('camposExtras').classList.remove('hidden-field');document.getElementById('camposGanhos').classList.remove('hidden-field');document.getElementById('btnPublicarJornada').classList.remove('hidden-field');carregarEExibirDados(originalDay);},300);}
function calcularGanhoBrutoAcumulado(trechos){let ganhoBrutoAcumulado=0;trechos.forEach(trecho=>{if(trecho.publicado){ganhoBrutoAcumulado+=(trecho.uber||0)+(trecho.n99||0)+(trecho.indrive||0)+(trecho.pf||0);}});return ganhoBrutoAcumulado;}
function salvarRascunho(){
    const index=parseInt(document.getElementById('trechoIndexToEdit').value),dataSelecionada=document.getElementById('dataJornada').value,originalDay=document.getElementById('originalExibitionDay').value;
    if(!dataSelecionada){alert("A data da jornada deve ser selecionada.");return;}
    const targetDailyData=ensureDailyDataStructure(dataSelecionada),sourceDailyData=relatoriosDiarios[originalDay],kmI=parseFloat(document.getElementById('kmInicialTrecho').value),hI=document.getElementById('horaInicialTrecho').value,kmF=parseFloat(document.getElementById('kmFinalTrecho').value)||0,hF=document.getElementById('horaFinalTrecho').value||'',u_total_app=parseFloat(document.getElementById('ganhoUber').value)||0,n_total_app=parseFloat(document.getElementById('ganho99').value)||0,ind_total_app=parseFloat(document.getElementById('ganhoIndrive').value)||0,p_total_app=parseFloat(document.getElementById('ganhoPF').value)||0,totalGanhoApp=u_total_app+n_total_app+ind_total_app+p_total_app;
    if(!kmI||!hI){alert("Pelo menos o KM Inicial e o Horário Inicial devem ser preenchidos para salvar um rascunho.");return;}
    if(kmF>0&&kmF<=kmI){alert(`O KM final (${kmF.toFixed(0)}) deve ser maior que o KM inicial (${kmI.toFixed(0)}).`);return;}
    if(hF&&kmF>0&&calcularDiferencaHoras(hI,hF)<=0){alert("A Hora Final deve ser posterior à Hora Inicial (mesmo que no dia seguinte).");return;}
    let u_final=u_total_app||0,n_final=n_total_app||0,ind_final=ind_total_app||0,p_final=p_total_app||0;
    let rascunho={kmInicial:kmI,kmFinal:kmF>0?kmF:null,horaInicial:hI,horaFinal:hF||null,uber:u_final,n99:n_final,indrive:ind_final,pf:p_final,publicado:false,rascunho:true};
    if(index!==-1&&dataSelecionada!==originalDay){if(sourceDailyData&&sourceDailyData.trechos[index])sourceDailyData.trechos.splice(index,1);targetDailyData.trechos.push(rascunho);relatoriosDiarios[originalDay]=sourceDailyData;}else if(index!==-1){targetDailyData.trechos[index]=rascunho;}else{targetDailyData.trechos.push(rascunho);}
    if(dataSelecionada!==originalDay){relatoriosDiarios[dataSelecionada]=targetDailyData;diaExibido=originalDay;dadosDoDiaExibido=relatoriosDiarios[originalDay];}else{dadosDoDiaExibido=targetDailyData;}
    salvarDados();
    // Fechar modal e mostrar barra ONLINE
    fecharModalRegistro();
    mostrarBarraOnline();
}
function publicarJornada(){
    const index=parseInt(document.getElementById('trechoIndexToEdit').value),dataSelecionada=document.getElementById('dataJornada').value,originalDay=document.getElementById('originalExibitionDay').value;
    if(!dataSelecionada){alert("A data da jornada deve ser selecionada.");return;}
    const targetDailyData=ensureDailyDataStructure(dataSelecionada),sourceDailyData=relatoriosDiarios[originalDay],kmI=parseFloat(document.getElementById('kmInicialTrecho').value),hI=document.getElementById('horaInicialTrecho').value,kmF=parseFloat(document.getElementById('kmFinalTrecho').value),hF=document.getElementById('horaFinalTrecho').value,u_total_app=parseFloat(document.getElementById('ganhoUber').value)||0,n_total_app=parseFloat(document.getElementById('ganho99').value)||0,ind_total_app=parseFloat(document.getElementById('ganhoIndrive').value)||0,p_total_app=parseFloat(document.getElementById('ganhoPF').value)||0,totalGanhoApp=u_total_app+n_total_app+ind_total_app+p_total_app;
    if(!kmI||!hI||!kmF||!hF){alert("KM Final e Horário Final são obrigatórios para PUBLICAR a jornada.");return;}
    if(kmF<=kmI){alert(`O KM final (${kmF.toFixed(0)}) deve ser maior que o KM inicial (${kmI.toFixed(0)}).`);return;}
    if(calcularDiferencaHoras(hI,hF)<=0){alert("A Hora Final deve ser posterior à Hora Inicial (mesmo que no dia seguinte).");return;}
    let ganhoAcumuladoUber=0,ganhoAcumulado99=0,ganhoAcumuladoIndrive=0,ganhoAcumuladoPF=0;
    targetDailyData.trechos.forEach((trecho,idx)=>{if(index!==-1&&idx===index){return;}
    if(trecho.publicado){ganhoAcumuladoUber+=trecho.uber||0;ganhoAcumulado99+=trecho.n99||0;ganhoAcumuladoIndrive+=trecho.indrive||0;ganhoAcumuladoPF+=trecho.pf||0;}});
    let u_final=u_total_app-ganhoAcumuladoUber,n_final=n_total_app-ganhoAcumulado99,ind_final=ind_total_app-ganhoAcumuladoIndrive,p_final=p_total_app-ganhoAcumuladoPF;
    if(u_final<0||n_final<0||ind_final<0||p_final<0){alert(`O Ganho Total Atual por app não pode ser menor que o acumulado nos trechos anteriores.\n`+`Uber: R$ ${u_total_app.toFixed(2)} (acumulado: R$ ${ganhoAcumuladoUber.toFixed(2)})\n`+`99: R$ ${n_total_app.toFixed(2)} (acumulado: R$ ${ganhoAcumulado99.toFixed(2)})\n`+`Indrive: R$ ${ind_total_app.toFixed(2)} (acumulado: R$ ${ganhoAcumuladoIndrive.toFixed(2)})\n`+`PF: R$ ${p_total_app.toFixed(2)} (acumulado: R$ ${ganhoAcumuladoPF.toFixed(2)})\n`+`Corrija os valores.`);return;}
    let jornadaPublicada={kmInicial:kmI,kmFinal:kmF,horaInicial:hI,horaFinal:hF,uber:u_final,n99:n_final,indrive:ind_final,pf:p_final,publicado:true,rascunho:false};
    if(index!==-1&&dataSelecionada!==originalDay){if(sourceDailyData&&sourceDailyData.trechos[index])sourceDailyData.trechos.splice(index,1);targetDailyData.trechos.push(jornadaPublicada);relatoriosDiarios[originalDay]=sourceDailyData;}else if(index!==-1){targetDailyData.trechos[index]=jornadaPublicada;}else{targetDailyData.trechos.push(jornadaPublicada);}
    if(dataSelecionada!==originalDay){relatoriosDiarios[dataSelecionada]=targetDailyData;diaExibido=originalDay;dadosDoDiaExibido=relatoriosDiarios[originalDay];}else{dadosDoDiaExibido=targetDailyData;}
    salvarDados();
    // Fechar modal e esconder barra ONLINE
    fecharModalRegistro();
    esconderBarraOnline();
}
function removerTrecho(index){const trechos=dadosDoDiaExibido.trechos,trechoParaRemover=trechos[index],status=trechoParaRemover.publicado?'Jornada Publicada':'Rascunho';if(confirm(`Tem certeza que deseja remover este ${status} (Jornada ${index+1})?`)){trechos.splice(index,1);salvarDados();atualizarUI();}}
function calcularIntervalos(trechos){let totalIntervalos=0;const trechosPublicados=trechos.filter(t=>t.publicado),trechosOrdenados=[...trechosPublicados].sort((a,b)=>{return a.horaInicial.localeCompare(b.horaInicial);});for(let i=1;i<trechosOrdenados.length;i++){const trechoAnterior=trechosOrdenados[i-1],trechoAtual=trechosOrdenados[i];if(trechoAnterior.horaFinal&&trechoAtual.horaInicial){const intervalo=calcularDiferencaHoras(trechoAnterior.horaFinal,trechoAtual.horaInicial);if(intervalo>0){totalIntervalos+=intervalo;}}}return totalIntervalos;}
function calcularTotaisDaSemana(startDate){
    const dadosSemanais=[];
    let totalLucroSemana=0;
    const isCurrentWeek=formatDateToKey(startDate)===getCurrentWeekMonday(TODAY_DATE_STRING),todayDate=new Date(TODAY_DATE_STRING+'T00:00:00');
    
    for(let i=0;i<7;i++){
        const d=new Date(startDate);
        d.setDate(startDate.getDate()+i);
        const dateKey=formatDateToKey(d);
        const dailyData=ensureDailyDataStructure(dateKey);
        const totaisDoDia=calcularTotaisDoDia(dailyData);
        totalLucroSemana+=totaisDoDia.lucroLiquido;
        dadosSemanais.push({
            dateKey,
            diaSemana:diasDaSemanaGrafico[i],
            diaMes:d.getDate(),
            lucroLiquido:totaisDoDia.lucroLiquido,
            isFuture:isCurrentWeek&&d>todayDate
        });
    }

    // CORREÇÃO AQUI: Calcular o mês final corretamente
    const startDay=dadosSemanais[0].diaMes;
    const endDay=dadosSemanais[6].diaMes;
    const endDate = new Date(startDate);
    endDate.setDate(startDate.getDate() + 6);
    const startMonth=meses[startDate.getMonth()].substring(0,3).toUpperCase();
    const endMonth=meses[endDate.getMonth()].substring(0,3).toUpperCase();
    
    document.getElementById('weeklyDateRange').innerText=`${startDay}/${startMonth} - ${endDay}/${endMonth}`;
    document.getElementById('weeklyTotalProfit').innerText=`R$ ${totalLucroSemana.toFixed(2).replace('.',',')}`;
    document.getElementById('nextWeekBtn').disabled=isCurrentWeek;
    
    return dadosSemanais;
}
function renderizarGraficoSemanal(dadosSemanais){currentWeeklyData=dadosSemanais;const ctx=document.getElementById('weeklyProfitChart').getContext('2d'),labels=dadosSemanais.map(d=>`${d.diaMes}\n${d.diaSemana}`),data=dadosSemanais.map(d=>d.lucroLiquido);if(weeklyChart)weeklyChart.destroy();const secondaryColor=getComputedStyle(document.documentElement).getPropertyValue('--secondary').trim()||'#22c55e',redColor=getComputedStyle(document.documentElement).getPropertyValue('--action-red').trim()||'#ef4444',darkColor=getComputedStyle(document.documentElement).getPropertyValue('--action-dark').trim()||'#000';const positiveColor=secondaryColor+'CC',negativeColor=redColor+'CC',futureColor='rgba(203,213,225,0.8)';weeklyChart=new Chart(ctx,{type:'bar',data:{labels,datasets:[{data,backgroundColor:dadosSemanais.map(d=>d.isFuture?futureColor:d.lucroLiquido>0?positiveColor:negativeColor),borderColor:dadosSemanais.map(d=>d.isFuture?'rgba(203,213,225,1)':d.lucroLiquido>0?secondaryColor:redColor),borderWidth:1,borderRadius:4,barPercentage:0.8,categoryPercentage:0.9,}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false},tooltip:{enabled:true,callbacks:{label:context=>{let label=context.dataset.label||'';if(label)label+=': ';if(context.parsed.y!==null)label+=new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL'}).format(context.parsed.y);return label;}}}},scales:{y:{display:false,beginAtZero:true,suggestedMax:Math.max(...data,0)*1.2>0?Math.max(...data,0)*1.2:50,grid:{display:false},ticks:{callback:value=>`R$ ${value.toFixed(2)}`}},x:{grid:{display:false,drawBorder:false},ticks:{color:darkColor,font:{size:10,family:'Roboto'},callback:function(value,index,values){const label=this.getLabelForValue(value);return label.split('\n');}}}},animation:{duration:800,easing:'easeOutQuart'},onClick:(evt,elements)=>{if(elements.length>0){const index=elements[0].index;const clickedDay=dadosSemanais[index];if(clickedDay&&!clickedDay.isFuture){showDailyDetail(clickedDay.dateKey);}}}}});}
function toggleLucroBruto(){isShowingLucroLiquido=!isShowingLucroLiquido;atualizarDisplayLucro();}
function toggleLucroDisplay(){isLucroVisible=!isLucroVisible;atualizarDisplayLucro();}
function atualizarDisplayLucro(){const lucroEl=document.getElementById('lucroLiquidoTotal'),lucroLabel=document.getElementById('lucroLabel'),toggleBtn=document.getElementById('toggleLucroBtn'),totais=calcularTotaisDoDia(dadosDoDiaExibido);if(isLucroVisible){if(isShowingLucroLiquido){lucroEl.innerHTML=`<span class="currency">R$</span> ${totais.lucroLiquido.toFixed(2).replace('.',',')}`;lucroLabel.innerText='Lucro Líquido Atual';toggleBtn.innerHTML='<i class="fa-solid fa-eye-slash"></i>';}else{lucroEl.innerHTML=`<span class="currency">R$</span> ${totais.brutoTotal.toFixed(2).replace('.',',')}`;lucroLabel.innerText='Lucro Bruto Atual';toggleBtn.innerHTML='<i class="fa-solid fa-eye-slash"></i>';}}else{lucroEl.innerText='••••';lucroLabel.innerText=isShowingLucroLiquido?'Lucro Líquido Atual':'Lucro Bruto Atual';toggleBtn.innerHTML='<i class="fa-solid fa-eye"></i>';}}
function atualizarDisplayTrechos(){const listEl=document.getElementById('trechosList');listEl.innerHTML='';const totais=calcularTotaisDoDia(dadosDoDiaExibido);let trechos=[...dadosDoDiaExibido.trechos];if(sortOrder==='recente'){trechos=trechos.reverse();}
document.getElementById('dailyDateDisplay').innerText=formatDateToLongDisplay(diaExibido);atualizarDisplayLucro();document.getElementById('kmPercorridosTotal').innerHTML=`<span class="value-number">${totais.kmTotal.toFixed(0)}</span><span class="value-unit">km</span>`;document.getElementById('horasDirigidasTotal').innerText=decimalParaHorasHHMM(totais.horasTotalDecimal);document.getElementById('reaisPorKmTotal').innerHTML=`<span class="value-currency">R$</span><span class="value-number">${totais.reaisPorKm.toFixed(2).replace('.',',')}</span>`;document.getElementById('reaisPorHoraTotal').innerHTML=`<span class="value-currency">R$</span><span class="value-number">${totais.reaisPorHora.toFixed(2).replace('.',',')}</span>`;document.getElementById('totalTrechos').innerText=trechos.length;if(trechos.length===0){listEl.innerHTML='<p style="text-align:center;color:var(--muted);padding:20px;grid-column:1/-1>Nenhuma jornada publicada ou rascunho salvo ainda.</p>';}else{trechos.forEach((trecho,displayIndex)=>{const actualIndex=dadosDoDiaExibido.trechos.findIndex(t=>t.kmInicial===trecho.kmInicial&&t.horaInicial===trecho.horaInicial&&t.uber===trecho.uber);const kmRodado=trecho.publicado?(trecho.kmFinal-trecho.kmInicial):0,horasRodadas=trecho.publicado?calcularDiferencaHoras(trecho.horaInicial,trecho.horaFinal):0,ganhoBrutoTrecho=(trecho.uber||0)+(trecho.n99||0)+(trecho.indrive||0)+(trecho.pf||0),reaisPorKm=(horasRodadas>0&&kmRodado>0)?(ganhoBrutoTrecho/kmRodado):0,reaisPorHora=(horasRodadas>0)?(ganhoBrutoTrecho/horasRodadas):0,showStarKm=reaisPorKm>=1.50,showStarHora=reaisPorHora>=50.00,eficiencia=trecho.publicado?calcularEficienciaJornada(reaisPorKm,reaisPorHora):0,corEficiencia=obterCorEficiencia(eficiencia);let itemClass=trecho.publicado?'jornada-card':'jornada-card rascunho';const item=document.createElement('div');item.className=itemClass;if(trecho.publicado){item.innerHTML=`<div class="jornada-header"><div class="jornada-header-left"><div class="jornada-km">${kmRodado.toFixed(0)} km Percorridos</div><div class="jornada-km-horario"><span class="jornada-horario">${trecho.horaInicial} às ${trecho.horaFinal}</span></div></div><div class="jornada-header-right"><button class="btn-edit" onclick="abrirModalRegistro(${actualIndex})"><i class="fa-solid fa-pen"></i></button><button class="btn-delete" onclick="removerTrecho(${actualIndex})"><i class="fa-solid fa-trash-can"></i></button></div></div><div class="divider-line"></div><div class="jornada-info-grid"><div class="jornada-info-item"><div class="jornada-info-label">Horas</div><div class="jornada-info-value">${decimalParaHorasHHMM(horasRodadas)}</div></div><div class="jornada-info-item"><div class="jornada-info-label">Bruto</div><div class="jornada-info-value">${ganhoBrutoTrecho.toFixed(2).replace('.',',')}</div></div><div class="jornada-info-item"><div class="jornada-info-label">R$/km${showStarKm?'<i class="fa-solid fa-star star-icon"></i>':''}</div><div class="jornada-info-value">${reaisPorKm.toFixed(2).replace('.',',')}</div></div><div class="jornada-info-item"><div class="jornada-info-label">R$/Hora${showStarHora?'<i class="fa-solid fa-star star-icon"></i>':''}</div><div class="jornada-info-value">${reaisPorHora.toFixed(2).replace('.',',')}</div></div></div><div class="jornada-footer"><div class="efficiency-line-chart"><div class="efficiency-label"><span>Eficiência da Jornada</span><span>${eficiencia.toFixed(0)}%</span></div><div class="efficiency-line-container"><div class="efficiency-line-fill" style="width:${eficiencia}%;background-color:${corEficiencia};"></div></div></div></div>`;}else{item.innerHTML=`<div class="jornada-header"><div class="jornada-header-left"><div class="jornada-km"><span class="rascunho-badge">RASCUNHO</span></div><div class="jornada-km-horario"><span class="jornada-horario">${trecho.horaInicial} ${trecho.horaFinal?'às '+trecho.horaFinal:''}</span></div></div><div class="jornada-header-right"><button class="btn-edit" onclick="abrirModalRegistro(${actualIndex})"><i class="fa-solid fa-pen"></i></button><button class="btn-delete" onclick="removerTrecho(${actualIndex})"><i class="fa-solid fa-trash-can"></i></button></div></div><div class="divider-line"></div><div class="jornada-info-grid"><div class="jornada-info-item"><div class="jornada-info-label">KM Inicial</div><div class="jornada-info-value">${trecho.kmInicial}</div></div><div class="jornada-info-item"><div class="jornada-info-label">KM Final</div><div class="jornada-info-value">${trecho.kmFinal||'--'}</div></div><div class="jornada-info-item"><div class="jornada-info-label">Bruto</div><div class="jornada-info-value">${ganhoBrutoTrecho.toFixed(2).replace('.',',')}</div></div><div class="jornada-info-item"><div class="jornada-info-label">R$/Hora</div><div class="jornada-info-value">--</div></div></div>`;}
listEl.appendChild(item);});}}
function atualizarUI(){atualizarDisplayTrechos();updateWeeklyChart();}
function getCurrentWeekMonday(dateString){const today=new Date(dateString+'T00:00:00'),dayOfWeek=today.getDay(),diff=(dayOfWeek-1+7)%7,monday=new Date(today);monday.setDate(today.getDate()-diff);return formatDateToKey(monday);}
function updateWeeklyChart(){if(!currentWeekStartDate)currentWeekStartDate=getCurrentWeekMonday(TODAY_DATE_STRING);const mondayDate=new Date(currentWeekStartDate+'T00:00:00'),dadosGraficoSemanal=calcularTotaisDaSemana(mondayDate);renderizarGraficoSemanal(dadosGraficoSemanal);}
function changeWeek(direction){const currentMonday=new Date(currentWeekStartDate+'T00:00:00');currentMonday.setDate(currentMonday.getDate()+(7*direction));currentWeekStartDate=formatDateToKey(currentMonday);updateWeeklyChart();}
function changeDay(direction){const currentDate=new Date(diaExibido+'T00:00:00');currentDate.setDate(currentDate.getDate()+direction);carregarEExibirDados(formatDateToKey(currentDate));}
function salvarImagem(){const dropUpContainer=document.getElementById('dropUpContainer'),headerBar=document.getElementById('headerActionsBar'),displayOriginalDropUp=dropUpContainer.style.display,visibilityOriginalHeaderBar=headerBar.style.visibility;dropUpContainer.style.display='none';headerBar.style.visibility='hidden';const dashboard=document.getElementById('dashboard');html2canvas(dashboard,{scale:3,useCORS:true,backgroundColor:"#ffffff"}).then(canvas=>{const link=document.createElement('a');link.download=`Relatorio_${new Date().toISOString().slice(0,10)}.jpg`;link.href=canvas.toDataURL("image/jpeg",0.95);link.click();dropUpContainer.style.display=displayOriginalDropUp;headerBar.style.visibility=visibilityOriginalHeaderBar;});}
function calcularEficienciaJornada(reaisPorKm,reaisPorHora){let percentKm=0;if(reaisPorKm>=2.00){percentKm=100;}else if(reaisPorKm>=1.50){percentKm=75+((reaisPorKm-1.50)/0.50)*25;}else if(reaisPorKm>=1.30){percentKm=50+((reaisPorKm-1.30)/0.20)*25;}else if(reaisPorKm>=1.00){percentKm=25+((reaisPorKm-1.00)/0.30)*25;}else{percentKm=(reaisPorKm/1.00)*25;}
let percentHora=0;if(reaisPorHora>=60.00){percentHora=100;}else if(reaisPorHora>=50.00){percentHora=75+((reaisPorHora-50.00)/10.00)*25;}else if(reaisPorHora>=40.00){percentHora=50+((reaisPorHora-40.00)/10.00)*25;}else if(reaisPorHora>=30.00){percentHora=25+((reaisPorHora-30.00)/10.00)*25;}else{percentHora=(reaisPorHora/30.00)*25;}
const eficiencia=(percentKm*0.4)+(percentHora*0.6);return Math.min(eficiencia,100);}
function obterCorEficiencia(eficiencia){if(eficiencia>=80){return'#166534';}else if(eficiencia>=50){return'#22c55e';}else if(eficiencia>=30){return'#4ade80';}else{return'#e5e7eb';}}
function abrirModalRelatorio(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('flash-mode','modal-mode','modal-jornada','modal-config-gnv','modal-consciencia-zerar','modal-metas','modal-despesas','modal-pesquisa-despesas','modal-config-despesas-veiculo','modal-temas');flashOverlay.classList.add('modal-relatorio');document.getElementById('flashIcon').style.display='none';document.getElementById('flashText').style.display='none';document.getElementById('modalRegistroJornada').style.display='none';document.getElementById('modalConfiguracao').style.display='none';document.getElementById('modalConscienciaZerar').style.display='none';document.getElementById('modalMetas').style.display='none';document.getElementById('modalDespesas').style.display='none';document.getElementById('modalPesquisaDespesas').style.display='none';document.getElementById('modalConfigDespesasVeiculo').style.display='none';document.getElementById('modalTemas').style.display='none';document.getElementById('modalRelatorio').style.display='block';preencherRelatorioDiario();flashOverlay.style.display='flex';setTimeout(()=>flashOverlay.classList.add('show'),10);}
function fecharModalRelatorio(){const flashOverlay=document.getElementById('flashOverlay');flashOverlay.classList.remove('show');setTimeout(()=>{flashOverlay.style.display='none';document.getElementById('modalRelatorio').style.display='none';flashOverlay.classList.remove('modal-relatorio');},300);}
function preencherRelatorioDiario(){const totais=calcularTotaisDoDia(dadosDoDiaExibido);const mediaGNV=dadosDoDiaExibido.mediaGNV||18.00;const m3Gasto=mediaGNV>0?totais.kmTotal/mediaGNV:0;const intervalos=calcularIntervalos(dadosDoDiaExibido.trechos.filter(t=>t.publicado));const metaDia=obterMetaDoDia(diaExibido);document.getElementById('relatorio-data').textContent=formatarDataParaRelatorio(diaExibido);document.getElementById('relatorio-meta-valor').textContent=`R$ ${metaDia.toFixed(2).replace('.',',')}`;const progressoMeta=metaDia>0?(totais.lucroLiquido/metaDia)*100:0;const porcentagem=Math.min(Math.max(progressoMeta,0),100).toFixed(0);const grafico=document.getElementById('relatorio-meta-grafico');grafico.style.background=`conic-gradient(var(--action-dark) 0% ${porcentagem}%, rgba(255,255,255,0.3) ${porcentagem}% 100%)`;document.getElementById('relatorio-meta-porcentagem').textContent=`${porcentagem}%`;document.getElementById('relatorio-bruto').innerHTML=`<span class="currency-symbol">R$</span> ${totais.brutoTotal.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-lucro').innerHTML=`<span class="currency-symbol">R$</span> ${totais.lucroLiquido.toFixed(2).replace('.',',')}`;const margemLucro=totais.brutoTotal>0?(totais.lucroLiquido/totais.brutoTotal)*100:0;document.getElementById('relatorio-margem').textContent=`${margemLucro.toFixed(0)}%`;document.getElementById('relatorio-horas').textContent=decimalParaHorasHHMM(totais.horasTotalDecimal);document.getElementById('relatorio-km').textContent=`${totais.kmTotal.toFixed(0)}`;document.getElementById('relatorio-intervalos').textContent=decimalParaHorasHHMM(intervalos);document.getElementById('relatorio-reais-km').innerHTML=`<span class="currency-symbol">R$</span> ${totais.reaisPorKm.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-reais-hora').innerHTML=`<span class="currency-symbol">R$</span> ${totais.reaisPorHora.toFixed(2).replace('.',',')}`;const despesasPessoaisDoDia=despesas.pessoal[diaExibido]||[];const despesasVeiculoDoDia=despesas.veiculo[diaExibido]||[];const combustivelRegistrado=despesasVeiculoDoDia.find(d=>d.categoria==='combustivel'&&despesaDeveSerIncluidaNoCalculo(d));if(combustivelRegistrado){document.getElementById('relatorio-gasto-gnv').innerHTML=`<span class="currency-symbol">R$</span> ${(combustivelRegistrado.valorTotal||combustivelRegistrado.valor||0).toFixed(2).replace('.',',')}`;document.getElementById('relatorio-m3-gnv').textContent=`${combustivelRegistrado.quantidade||'0,00'}`;}else{document.getElementById('relatorio-gasto-gnv').innerHTML=`<span class="currency-symbol">R$</span> ${totais.gastoGNV.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-m3-gnv').textContent=`${m3Gasto.toFixed(2)}`;}
const outrosGastos=totais.totalDespesas-(combustivelRegistrado?(combustivelRegistrado.valorTotal||combustivelRegistrado.valor||0):totais.gastoGNV);document.getElementById('relatorio-outros-gastos').innerHTML=`<span class="currency-symbol">R$</span> ${outrosGastos.toFixed(2).replace('.',',')}`;const totalDespesas=totais.totalDespesas;document.getElementById('relatorio-total-despesas').innerHTML=`<span class="currency-symbol">R$</span> ${totalDespesas.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-uber').innerHTML=`<span class="currency-symbol">R$</span> ${totais.totalUber.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-99').innerHTML=`<span class="currency-symbol">R$</span> ${totais.total99.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-indrive').innerHTML=`<span class="currency-symbol">R$</span> ${totais.totalIndrive.toFixed(2).replace('.',',')}`;document.getElementById('relatorio-pf').innerHTML=`<span class="currency-symbol">R$</span> ${totais.totalPF.toFixed(2).replace('.',',')}`;const faltaParaMeta=Math.max(0,metaDia-totais.lucroLiquido);document.getElementById('relatorio-progresso-meta').style.width=`${Math.min(progressoMeta,100)}%`;document.getElementById('relatorio-progresso-texto').textContent=`${Math.min(progressoMeta,100).toFixed(0)}%`;document.getElementById('relatorio-falta-reais').textContent=`R$ ${faltaParaMeta.toFixed(2).replace('.',',')}`;let horasFaltantes='--';let faltaGnv='--';if(totais.reaisPorHora>0&&faltaParaMeta>0){horasFaltantes=decimalParaHorasHHMM(faltaParaMeta/totais.reaisPorHora);}
if(totais.reaisPorKm>0&&faltaParaMeta>0){const kmFaltantes=faltaParaMeta/totais.reaisPorKm;const gnvFaltante=mediaGNV>0?(kmFaltantes/mediaGNV)*(dadosDoDiaExibido.precoGNV||4.79):0;faltaGnv=`R$ ${gnvFaltante.toFixed(2).replace('.',',')}`;}
document.getElementById('relatorio-falta-horas').textContent=horasFaltantes;document.getElementById('relatorio-falta-gnv').textContent=faltaGnv;document.getElementById('relatorio-horas-faltantes').textContent=horasFaltantes;}
window.addEventListener('load',()=>{try{document.getElementById('flashOverlay').style.display='none';}catch(e){}
carregarDados();carregarMetas();carregarDespesas();carregarConfigDespesasVeiculo();currentWeekStartDate=getCurrentWeekMonday(TODAY_DATE_STRING);sortOrder='recente';const sortBtn=document.getElementById('sortToggleBtn'),sortIcon=document.getElementById('sortIcon');sortIcon.className='fa-solid fa-arrow-up';sortBtn.classList.remove('active');atualizarUI();const temaSalvo=localStorage.getItem(TEMA_STORAGE_KEY);if(temaSalvo){selecionarTema(temaSalvo);}else{const r=document.documentElement.style;r.setProperty('--primary','#166534');r.setProperty('--secondary','#22c55e');r.setProperty('--blue-light','#60a5fa');r.setProperty('--green-lime','#4ade80');r.setProperty('--action-save','#22c55e');}
document.getElementById('headerImage').src='https://i.ibb.co/6RjPPtvQ/Picsart-25-10-21-14-24-37-516.jpg';setTimeout(()=>{verificarAlertasOleo();},1000);verificarJornadaEmAndamento();});
function verificarAlertasOleo(){carregarDespesas();const hoje=new Date();const kmRodadosHoje=dadosDoDiaExibido?.trechos?.reduce((total,trecho)=>{return total+(trecho.publicado?(trecho.kmFinal-trecho.kmInicial):0);},0)||0;let temAlerta=false;Object.keys(despesas.veiculo).forEach(data=>{despesas.veiculo[data].forEach(despesa=>{if(despesa.categoria==='oleo'){const kmRestantes=despesa.proximaTroca-(despesa.kmAtual+kmRodadosHoje);if(kmRestantes<=500&&kmRestantes>0){temAlerta=true;mostrarAlertaOleo(kmRestantes);}else if(kmRestantes<=0){temAlerta=true;mostrarAlertaOleo(0);}}});});}
function mostrarAlertaOleo(kmRestantes){if(kmRestantes<=0){mostrarFlashTemporario('<i class="fa-solid fa-triangle-exclamation" style="color:#dc2626;font-size:48px"></i>','ATENÇÃO: Já passou da hora de trocar o óleo!','254,226,226');}else if(kmRestantes<=100){mostrarFlashTemporario('<i class="fa-solid fa-triangle-exclamation" style="color:#d97706;font-size:48px"></i>',`ATENÇÃO: Faltam apenas ${kmRestantes.toFixed(0)} km para trocar o óleo!`,'254,243,199');}else if(kmRestantes<=500){mostrarFlashTemporario('<i class="fa-solid fa-circle-info" style="color:#059669;font-size:48px"></i>',`Faltam ${kmRestantes.toFixed(0)} km para a próxima troca de óleo`,'209,250,229');}}
function mostrarBarraOnline(){document.getElementById('onlineStatusBar').style.display='flex';}
function esconderBarraOnline(){document.getElementById('onlineStatusBar').style.display='none';}
function verificarJornadaEmAndamento(){const dadosHoje=relatoriosDiarios[TODAY_DATE_STRING];if(dadosHoje&&dadosHoje.trechos){const temRascunho=dadosHoje.trechos.some(trecho=>trecho.rascunho&&!trecho.publicado);if(temRascunho){mostrarBarraOnline();}else{esconderBarraOnline();}}else{esconderBarraOnline();}}
</script>
</body>
</html>